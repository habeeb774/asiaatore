const l=typeof import.meta<"u"&&"https://my-store-backend-production.up.railway.app/api"||"/api";async function y(t,e={}){const r=t.startsWith("http")?t:`${l}${t}`,n=await fetch(r,{headers:{"Content-Type":"application/json",...e.headers||{}},...e,body:e.body?JSON.stringify(e.body):void 0}),i=await n.text(),a=i?JSON.parse(i):null;if(!n.ok){const s=new Error(a?.message||"API request failed");throw s.status=n.status,s.body=a,s}return a}const u=(t,e,r={})=>y(t,{method:"POST",body:e,headers:r});async function p(t,e){const r=t.startsWith("http")?t:`${l}${t}`;let n=null;try{n=localStorage.getItem("my_store_token")}catch{n=null}const i=n?{Authorization:`Bearer ${n}`}:void 0;let a;try{a=await fetch(r,{method:"POST",body:e,headers:i})}catch(d){const c=new Error("Network upload error: "+d.message);throw c.status=0,c}const s=await a.text();let o=null;try{o=s?JSON.parse(s):null}catch{o=null}if(!a.ok){const d=o?.message||o?.error||"Upload failed",c=new Error(d+(o?.error?` [${o.error}]`:""));throw c.status=a.status,c.body=o,c}return o}async function m(t={}){const e={order:{total:t.total??t.amount??0,currency:t.currency??"SAR",items:t.items||[]},localOrderId:t.orderId||t.localOrderId||null},r=`c-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`;return u("/pay/paypal/create-order",e,{"x-idempotency-key":r})}async function f(t){const e=`stc-c-${(t?.orderId||"x").slice?.(0,6)||"x"}-${Date.now().toString(36)}`;return u("/pay/stc/create",t,{"x-idempotency-key":e})}async function h({orderId:t,sessionId:e,success:r=!0}={}){const n=`stc-k-${(t||"x").slice?.(0,6)||"x"}-${Date.now().toString(36)}`;return u("/pay/stc/confirm",{orderId:t,sessionId:e,success:r},{"x-idempotency-key":n})}async function w({orderId:t}={}){const e=`bank-i-${(t||"x").slice?.(0,6)||"x"}-${Date.now().toString(36)}`;return u("/pay/bank/init",{orderId:t},{"x-idempotency-key":e})}async function k({orderId:t,file:e}){const r=new FormData;return r.append("orderId",t),r.append("receipt",e),p("/pay/bank/upload",r)}export{m as a,h as b,f as c,w as i,k as u};
