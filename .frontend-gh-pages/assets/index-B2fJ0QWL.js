import{b as L,u as D,a5 as I,R as w,j as e,L as f,r as b}from"./vendor.react-C0fmYGW5.js";import{f as B,b as C}from"./index-Df3LzoMm.js";import{B as N}from"./Button-DeEIw2lQ.js";import{L as p,I as g}from"./label-B8EBXIVn.js";import{C as v,a as y,b as S,c as E}from"./Card-CFi2J0az.js";import{b_ as F,b$ as A,c0 as h}from"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";/* empty css                     */const T=A({email:h().email("البريد الإلكتروني غير صحيح").min(1,"البريد مطلوب"),password:h().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل")}),Q=()=>{const{login:o,devLoginAs:c}=B()||{},u=L(),l=D(),i=l.state&&l.state.from||new URLSearchParams(l.search).get("redirect")||"/",{register:s,handleSubmit:m,formState:{errors:t,isSubmitting:d},setError:r,setFocus:a}=I({resolver:F(T),mode:"onSubmit"}),[n,_]=w.useState(!1);w.useEffect(()=>{a("email")},[a]);const P=async j=>{try{const x=await o(j.email.trim(),j.password);if(x.ok)u(i,{replace:!0});else{const R=x?.error==="INVALID_LOGIN"?"بيانات دخول خاطئة":x?.error==="USER_BLOCKED"?"تم إيقاف حسابك مؤقتًا":x?.error==="EMAIL_NOT_VERIFIED"?"يرجى تأكيد بريدك الإلكتروني أولاً":x?.error||"فشل تسجيل الدخول";r("root",{message:R})}}catch(x){r("root",{message:x.message||"خطأ غير متوقع"})}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(v,{className:"w-full max-w-md",children:[e.jsx(y,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsx(S,{children:"تسجيل الدخول"}),e.jsx("p",{className:"text-xs text-gray-500",children:"ادخل بيانات حسابك للوصول إلى المتجر ولوحة التحكم."})]})}),e.jsxs(E,{children:[e.jsxs("form",{onSubmit:m(P),className:"grid gap-4","aria-describedby":t.root?"login-error":void 0,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(g,{id:"email",type:"email",autoComplete:"email",placeholder:"example@mail.com",...s("email")}),t.email&&e.jsx("p",{className:"text-xs text-red-600",role:"alert",children:t.email.message})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"password",children:"كلمة المرور"}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password",type:n?"text":"password",autoComplete:"current-password",placeholder:"••••••••",...s("password"),className:"pr-16"}),e.jsx(N,{type:"button",variant:"ghost",size:"sm",className:"absolute top-1/2 -translate-y-1/2 right-1 text-xs text-gray-600",onClick:()=>_(j=>!j),title:n?"إخفاء":"إظهار",children:n?"إخفاء":"إظهار"})]}),t.password&&e.jsx("p",{className:"text-xs text-red-600",role:"alert",children:t.password.message})]}),t.root&&e.jsx("div",{id:"login-error",className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",role:"alert",children:t.root.message}),e.jsx(N,{type:"submit",disabled:d,className:"bg-gradient-to-r from-[#69be3c] to-amber-400",children:d?"...جاري الدخول":"دخول"})]}),e.jsxs("div",{className:"mt-4 grid gap-2",children:[e.jsx(f,{to:"/forgot",className:"text-xs underline text-gray-600 hover:text-gray-800",children:"نسيت كلمة المرور؟"}),!1]}),e.jsxs("p",{className:"mt-3 text-[0.72rem]",children:["ليس لديك حساب؟ ",e.jsx(f,{to:"/register",className:"underline",children:"إنشاء حساب"})]})]})]})})},k=A({name:h().trim().optional(),email:h().email("البريد الإلكتروني غير صحيح").min(1,"البريد مطلوب"),password:h().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirm:h().min(6,"التأكيد مطلوب")}).refine(o=>o.password===o.confirm,{message:"كلمتا المرور غير متطابقتين",path:["confirm"]}),W=()=>{const o=L(),{register:c,handleSubmit:u,setFocus:l,setError:i,formState:{errors:s,isSubmitting:m}}=I({resolver:F(k),mode:"onSubmit"});w.useEffect(()=>{l("email")},[l]);const t=async d=>{try{const r=await C.authRegister(d.email.trim(),d.password,(d.name||"").trim());if(r?.ok){o("/login",{replace:!0,state:{justRegistered:!0}});return}const a=r?.error==="EMAIL_EXISTS"?"البريد مستخدم بالفعل":r?.error||"فشل التسجيل";i("root",{message:a})}catch(r){const a=r?.code,n=r?.status;if(a==="EMAIL_EXISTS"||n===409)return i("email",{message:"البريد مستخدم بالفعل"});if(a==="INVALID_INPUT"||n===400)return i("root",{message:"بيانات غير صالحة، تحقق من الحقول"});if(a==="BAD_JSON")return i("root",{message:"خطأ في تنسيق البيانات، حاول مرة أخرى"});if(a==="DB_UNAVAILABLE"||n===503)return i("root",{message:"الخدمة غير متاحة مؤقتاً، حاول لاحقاً"});i("root",{message:r?.message&&r.message.replace(/^API Error \d+[^-]*-\s*/,"")||"خطأ غير متوقع"})}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(v,{className:"w-full max-w-md",children:[e.jsx(y,{children:e.jsx(S,{children:"إنشاء حساب"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:u(t),className:"grid gap-3","aria-describedby":s.root?"register-error":void 0,children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"name",children:"الاسم"}),e.jsx(g,{id:"name",placeholder:"الاسم",...c("name")})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(g,{id:"email",type:"email",autoComplete:"email",placeholder:"example@mail.com",...c("email")}),s.email&&e.jsx("p",{className:"text-xs text-red-600",role:"alert",children:s.email.message})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"password",children:"كلمة المرور"}),e.jsx(g,{id:"password",type:"password",autoComplete:"new-password",placeholder:"••••••••",...c("password")}),s.password&&e.jsx("p",{className:"text-xs text-red-600",role:"alert",children:s.password.message})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"confirm",children:"تأكيد كلمة المرور"}),e.jsx(g,{id:"confirm",type:"password",autoComplete:"new-password",placeholder:"••••••••",...c("confirm")}),s.confirm&&e.jsx("p",{className:"text-xs text-red-600",role:"alert",children:s.confirm.message})]}),s.root&&e.jsx("div",{id:"register-error",className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",role:"alert",children:s.root.message}),e.jsx(N,{type:"submit",disabled:m,className:"bg-gradient-to-r from-[#69be3c] to-amber-400",children:m?"...جاري":"تسجيل"}),e.jsxs("p",{className:"mt-1 text-[0.72rem]",children:["لديك حساب؟ ",e.jsx(f,{to:"/login",className:"underline",children:"دخول"})]})]})})]})})},Y=()=>{const[o,c]=b.useState(""),[u,l]=b.useState(!1),[i,s]=b.useState(null),[m,t]=b.useState(!1),d=async r=>{if(r.preventDefault(),!m){if(s(null),!o.trim())return s("أدخل البريد");try{t(!0);const a=await C.authForgot(o.trim());a.ok?l(!0):s(a.error||"فشل الإرسال")}catch(a){s(a.message||"خطأ غير متوقع")}finally{t(!1)}}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(v,{className:"w-full max-w-md",children:[e.jsx(y,{children:e.jsx(S,{children:"استرجاع كلمة المرور"})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:d,className:"grid gap-3",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"أدخل بريدك لإرسال رابط/رمز إعادة التعيين (محاكاة)."}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(p,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(g,{id:"email",type:"email",placeholder:"example@mail.com",value:o,onChange:r=>c(r.target.value)})]}),i?e.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:i}):null,u?e.jsx("div",{className:"rounded-md border border-green-200 bg-green-50 px-3 py-2 text-xs text-green-700",children:"تم إرسال رابط (وهمي) إن كان البريد مسجلاً."}):null,e.jsx(N,{type:"submit",disabled:m,className:"bg-gradient-to-r from-[#69be3c] to-amber-400",children:m?"...إرسال":"إرسال رابط"}),e.jsxs("p",{className:"mt-1 text-[0.72rem]",children:["تذكرت؟ ",e.jsx(f,{to:"/login",className:"underline",children:"عودة لتسجيل الدخول"})]})]})})]})})};export{Y as ForgotPasswordPage,Q as LoginPage,W as RegisterPage};
