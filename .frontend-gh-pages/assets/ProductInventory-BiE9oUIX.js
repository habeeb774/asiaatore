import{r as a,j as e}from"./vendor.react-C0fmYGW5.js";import{u as T,r as M,b as L}from"./index-8VDXgoeV.js";import"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";/* empty css                     */function Q({open:v,onClose:x,product:r,onAdjusted:o}){const[u,b]=a.useState(""),[j,p]=a.useState("set"),[g,f]=a.useState(""),[y,c]=a.useState(!1),[d,N]=a.useState(null),{locale:i}=T();if(!v||!r)return null;const w=async n=>{n.preventDefault(),c(!0),N(null);try{await L.inventoryAdjust(r.id,{quantity:Number(u),adjustment_type:j,reason:g}),c(!1),o&&o(),x()}catch(S){N(S.message||"خطأ في التعديل"),c(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 w-full max-w-md",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"تعديل مخزون المنتج"}),e.jsxs("div",{className:"mb-2 text-sm text-gray-700",children:[M(r?.name,i)||r.nameAr||r.name?.ar||r.name?.en||r.slug||""," (SKU: ",r.sku||"-",")"]}),e.jsxs("form",{onSubmit:w,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1",children:"الكمية الجديدة"}),e.jsx("input",{type:"number",className:"border rounded px-2 py-1 w-full",value:u,onChange:n=>b(n.target.value),required:!0,min:"0"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1",children:"نوع التعديل"}),e.jsxs("select",{className:"border rounded px-2 py-1 w-full",value:j,onChange:n=>p(n.target.value),children:[e.jsx("option",{value:"set",children:"تعيين"}),e.jsx("option",{value:"increment",children:"زيادة"}),e.jsx("option",{value:"decrement",children:"نقصان"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block mb-1",children:"السبب"}),e.jsx("input",{type:"text",className:"border rounded px-2 py-1 w-full",value:g,onChange:n=>f(n.target.value),placeholder:"مثال: توريد جديد، تعديل يدوي..."})]}),d&&e.jsx("div",{className:"text-red-600 mb-2 text-sm",children:d}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded",disabled:y,children:y?"جارٍ الحفظ...":"حفظ"}),e.jsx("button",{type:"button",className:"bg-gray-300 px-4 py-2 rounded",onClick:x,children:"إلغاء"})]})]})]})})}function q(){const[v,x]=a.useState([]),[r,o]=a.useState(!0),[u,b]=a.useState(null),[j,p]=a.useState(null),[g,f]=a.useState(!1),[y,c]=a.useState(0),[d,N]=a.useState(!1),[i,w]=a.useState("");a.useEffect(()=>{o(!0),b(null),Promise.all([L.listProducts(),L.inventoryList()]).then(([s,m])=>{const l=new Map;(m.items||[]).forEach(t=>{l.set(t.productId,t)});const h=s.map(t=>{const k=l.get(t.id)||{},A=k.quantity??t.stock??0,R=k.reservedQuantity??0,O=k.lowStockThreshold??5,E=A-R<=O;return{...t,stock:A,reservedQuantity:R,lowStockThreshold:O,isLowStock:!!E}});x(h),o(!1)}).catch(s=>{b(s.message||"خطأ في جلب البيانات"),o(!1)})},[y]);const n=s=>{p(s),f(!0)},S=()=>{f(!1),p(null)},P=()=>{c(s=>s+1)},C=v.filter(s=>{const m=!i||(s.name?.ar||s.nameAr||"").toLowerCase().includes(i.toLowerCase())||(s.sku||"").toLowerCase().includes(i.toLowerCase()),l=!d||s.isLowStock;return m&&l}),U=()=>{const s=[["Product Name (AR)","SKU","Stock","Reserved","Low Threshold","Is Low"].join(",")].concat(C.map(t=>[JSON.stringify(t.name?.ar||t.nameAr||""),JSON.stringify(t.sku||""),String(t.stock??0),String(t.reservedQuantity??0),String(t.lowStockThreshold??0),t.isLowStock?"yes":"no"].join(","))),m=new Blob([s.join(`
`)],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(m),h=document.createElement("a");h.href=l,h.download=d?"low-stock.csv":"inventory.csv",h.click(),URL.revokeObjectURL(l)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4",children:[e.jsx("h1",{className:"text-xl font-bold",children:"قائمة المنتجات والمخزون"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("input",{type:"text",className:"border rounded px-2 py-1",placeholder:"بحث بالاسم أو SKU",value:i,onChange:s=>w(s.target.value)}),e.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:s=>N(s.target.checked)}),e.jsx("span",{children:"عرض المخزون المنخفض فقط"})]}),e.jsx("button",{className:"bg-gray-100 border px-3 py-1 rounded",onClick:()=>c(s=>s+1),children:"تحديث"}),e.jsx("button",{className:"bg-green-600 text-white px-3 py-1 rounded",onClick:U,children:"تصدير CSV"})]})]}),r?e.jsx("div",{children:"جارٍ التحميل..."}):u?e.jsx("div",{className:"text-red-600",children:u}):e.jsxs("table",{className:"min-w-full border rounded shadow",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"اسم المنتج"}),e.jsx("th",{className:"p-2 border",children:"SKU"}),e.jsx("th",{className:"p-2 border",children:"المخزون الحالي"}),e.jsx("th",{className:"p-2 border",children:"محجوز"}),e.jsx("th",{className:"p-2 border",children:"الحد الأدنى"}),e.jsx("th",{className:"p-2 border",children:"تعديل سريع"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{className:s.isLowStock?"bg-red-50":"",children:[e.jsx("td",{className:"p-2 border",children:s.name?.ar||s.nameAr}),e.jsx("td",{className:"p-2 border",children:s.sku||"-"}),e.jsx("td",{className:"p-2 border font-bold",children:s.stock}),e.jsx("td",{className:"p-2 border",children:s.reservedQuantity}),e.jsx("td",{className:"p-2 border",children:s.lowStockThreshold}),e.jsx("td",{className:"p-2 border",children:e.jsx("button",{className:"bg-blue-600 text-white px-3 py-1 rounded",onClick:()=>n(s),children:"تعديل"})})]},s.id))})]}),e.jsx(Q,{open:g,onClose:S,product:j,onAdjusted:P})]})}function G(){return e.jsx(q,{})}export{G as default};
