import{r,b as I,u as B,j as a,L as $}from"./vendor.react-C0fmYGW5.js";import{u as D,a as E,r as F,n as b}from"./index-B0cb22ux.js";import{Q as z}from"./QuickViewModal-CpkSfHrV.js";import{L as O}from"./LazyImage-SqLtajCp.js";const q=r.memo(({product:e,hasDiscount:i,discountPercent:n,outOfStock:t,showImageBadge:s,locale:l})=>a.jsxs(a.Fragment,{children:[e.badge&&a.jsx("span",{className:"badge",children:l==="ar"?"جديد":"New"}),s&&i&&a.jsxs("span",{className:"discount-badge",children:["-",n,"%"]}),t&&a.jsx("span",{className:"gallery-indicator",style:{background:"rgba(109,1,11,.85)"},children:l==="ar"?"غير متوفر":"Out"})]})),Q=r.memo(({rating:e})=>e?a.jsx("div",{className:"rating-row","aria-label":`rating ${e}`,children:[1,2,3,4,5].map(i=>a.jsx("span",{className:`star ${i<=e?"":"off"}`,children:"★"},i))}):null),G=r.memo(({price:e,baseOld:i,hasDiscount:n,discountPercent:t,savings:s,showPriceBadge:l,locale:c})=>a.jsxs("div",{className:"price-row",children:[a.jsxs("span",{className:"price",children:[e," ",c==="ar"?"ر.س":"SAR"]}),Number.isFinite(i)&&a.jsx("span",{className:"old",children:i}),l&&n&&typeof t=="number"&&a.jsxs("span",{className:"badge-soft",style:{fontSize:".62rem",padding:".15rem .4rem",borderRadius:8,marginInlineStart:6},children:["-",t,"%"]}),n&&s>0&&a.jsx("span",{className:"save-badge","aria-label":c==="ar"?`وفرت ${s} ر.س`:`Saved ${s} SAR`,children:c==="ar"?`وفّرت ${s} ر.س`:`Saved ${s} SAR`})]})),U=r.memo(({product:e,currentQty:i,maxPerItem:n,outOfStock:t,locale:s,t:l,onAddToCart:c})=>{const[o,g]=r.useState("idle"),m=i>=(n||10);r.useEffect(()=>{m?g("max"):o==="max"&&g("idle")},[m,o]);const f=r.useCallback(()=>{if(t||m)return;const h=c(e,1);if(h?.ok){const w=i+1>=(n||10);g(w?"max":"added");const p=setTimeout(()=>{g(w?"max":"idle")},1400);return()=>clearTimeout(p)}return h},[e,i,n,t,m,c]),N=r.useCallback(()=>t?s==="ar"?"غير متوفر":"Out of stock":m?s==="ar"?"الحد الأقصى":"Max":o==="added"?s==="ar"?"✓ تمت الإضافة":"✓ Added":l("addToCart"),[t,m,o,s,l]),v=r.useCallback(()=>t?s==="ar"?"غير متوفر":"Out of stock":m?s==="ar"?"الحد الأقصى":"Max reached":l("addToCart"),[t,m,s,l]);return a.jsx("button",{className:`primary ${o==="added"?"added":""} ${o==="max"?"at-max":""}`,disabled:t||m,onClick:f,"aria-label":v(),children:N()})}),_=({product:e,showImageBadge:i=!0,showPriceBadge:n=!0,priority:t=!1})=>{const{locale:s,t:l}=D(),{addToCart:c,cartItems:o,maxPerItem:g}=E()||{addToCart:()=>({}),cartItems:[],maxPerItem:10},m=I(),f=B(),[N,v]=r.useState(!1),h=r.useMemo(()=>F(e?.name??e?.title,s)||(typeof e?.name=="string"?e.name:e?.title)||"",[e,s]),w=r.useMemo(()=>`${s==="ar"?"":"/"+s}/product/${e.id}`,[s,e.id]),{baseOld:p,priceNum:K,hasDiscount:S,discountPercent:C,savings:y,outOfStock:k}=r.useMemo(()=>{const d=e?.oldPrice??e?.originalPrice,x=d!=null?+d:void 0,u=e?.price!=null?+e.price:void 0,j=Number.isFinite(x)&&Number.isFinite(u)&&x>u,A=j?Math.round((1-u/x)*100):null,R=j?Math.max(0,x-u):0,L=e.stock!==void 0&&e.stock<=0;return{baseOld:x,priceNum:u,hasDiscount:j,discountPercent:A,savings:R,outOfStock:L}},[e]),P=r.useMemo(()=>o?.find(d=>d.id===e.id),[o,e.id])?.quantity||0,M=r.useCallback((d,x)=>{const u=c(d,x);if(u?.reason==="AUTH_REQUIRED"){const j=f.pathname+(f.search||"");m("/login",{state:{from:j}})}return u},[c,m,f]),T=r.useCallback(d=>{d.preventDefault(),d.stopPropagation(),v(!0)},[]),V=r.useMemo(()=>({avifSrcSet:e.imageVariants?.avif?[e.imageVariants.avif.thumb&&`${e.imageVariants.avif.thumb} 200w`,e.imageVariants.avif.medium&&`${e.imageVariants.avif.medium} 400w`,e.imageVariants.avif.large&&`${e.imageVariants.avif.large} 800w`].filter(Boolean).join(", "):void 0,webpSrcSet:e.imageVariants?.webp?[e.imageVariants.webp.thumb&&`${e.imageVariants.webp.thumb} 200w`,e.imageVariants.webp.medium&&`${e.imageVariants.webp.medium} 400w`,e.imageVariants.webp.large&&`${e.imageVariants.webp.large} 800w`].filter(Boolean).join(", "):void 0}),[e.imageVariants]);return a.jsxs("div",{className:"product-card","data-id":e.id,children:[a.jsxs($,{to:w,className:"product-image product-media","aria-label":h,children:[a.jsx(O,{src:e.imageVariants?.thumb||e.image,alt:h,className:"w-full h-full object-cover",sizes:"(max-width: 640px) 50vw, (max-width: 1024px) 25vw, 240px",avifSrcSet:V.avifSrcSet,webpSrcSet:V.webpSrcSet,width:400,height:400,priority:t}),a.jsx(q,{product:e,hasDiscount:S,discountPercent:C,outOfStock:k,showImageBadge:i,locale:s}),a.jsx("div",{className:"product-overlay",children:a.jsx("button",{className:"quick-view-btn",onClick:T,children:l("quickView")})})]}),a.jsx("h3",{className:"product-title clamp-2",children:h}),a.jsx(Q,{rating:e.rating}),a.jsx(G,{price:e.price,baseOld:p,hasDiscount:S,discountPercent:C,savings:y,showPriceBadge:n,locale:s}),a.jsxs("div",{className:"actions",children:[a.jsx(U,{product:e,currentQty:P,maxPerItem:g,outOfStock:k,locale:s,t:l,onAddToCart:M}),a.jsx($,{to:w,children:l("details")})]}),N&&a.jsx(z,{product:e,onClose:()=>v(!1)})]})},H=r.memo(_),se=({products:e,wide:i,showImageBadge:n=!0,showPriceBadge:t=!0})=>a.jsx("div",{className:`products-grid ${i?"wide":""} grid grid-cols-1 sm:grid-cols-2 gap-6`,children:e.map((s,l)=>a.jsx(H,{product:s,showImageBadge:n,showPriceBadge:t,priority:l<2},s.id))}),W=()=>a.jsxs("div",{className:"product-card p-4",children:[a.jsx(b,{className:"h-40 w-full rounded-lg mb-3"}),a.jsx(b,{className:"h-3 w-3/4 mb-2"}),a.jsx(b,{className:"h-3 w-1/2 mb-4"}),a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(b,{className:"h-5 w-20"}),a.jsx(b,{className:"h-5 w-10"})]}),a.jsx(b,{className:"h-9 w-full rounded"})]});function J(e){if(typeof window>"u")return 12;const i=window.innerWidth||1200;return(i>=1280?e?5:4:i>=1024?e?4:3:i>=640?2:1)*3}const ie=({count:e,wide:i=!1})=>{const n=Number.isFinite(e)?e:J(i);return a.jsx("div",{className:`products-grid ${i?"wide":""}`,role:"status","aria-live":"polite","aria-busy":"true",children:Array.from({length:n}).map((t,s)=>a.jsx(W,{},s))})};export{ie as P,se as a};
