import{b as C,u as L,r as l,n as R,j as s}from"./vendor.react-C0fmYGW5.js";import{u as T,a as D,r as y}from"./index-B0cb22ux.js";import{L as Q}from"./LazyImage-SqLtajCp.js";const F=({product:e,onClose:x})=>{const{locale:i,t:b}=T(),{addToCart:I,cartItems:z,maxPerItem:h}=D()||{addToCart:()=>{},cartItems:[],maxPerItem:10},E=C(),S=L(),[g,p]=l.useState("idle"),f=z?.find(t=>t.id===e?.id)?.quantity||0,c=f>=(h||10);l.useEffect(()=>{c&&p("max")},[c]),l.useEffect(()=>{const t=a=>{a.key==="Escape"&&x()};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[x]);const n=Array.isArray(e?.variants)?e.variants:[],v=l.useMemo(()=>Array.isArray(e?.options)&&e.options.length?e.options:n&&n.length?Object.keys(n[0].attributes||{}).map(a=>({name:a,values:Array.from(new Set(n.map(o=>o.attributes?.[a]??"")))})):[],[e?.options,n]),[u,P]=l.useState(()=>{if(n&&n.length&&n[0].attributes)return{...n[0].attributes};const t={};return(e?.options||[]).forEach(a=>{t[a.name]=a.values?.[0]??""}),t}),r=l.useMemo(()=>!n||!n.length?null:n.find(t=>{const a=t.attributes||{};return Object.keys(u).every(o=>String(a[o]??"")===String(u[o]??""))})||n[0],[n,u]),A=r?.price??e?.price,w=r?.oldPrice??e?.oldPrice,d=(r?.stock??e?.stock)!==void 0&&(r?.stock??e?.stock)<=0,[m,N]=l.useState(1);if(!e)return null;const q=y(e?.name??e?.title,i)||(typeof e?.name=="string"?e.name:e?.title)||"",k=e?.oldPrice&&e?.oldPrice>e?.price,j=k?Math.round((1-e?.price/e?.oldPrice)*100):null;return R.createPortal(s.jsx("div",{className:"quick-view-overlay",role:"dialog","aria-modal":"true",children:s.jsxs("div",{className:"quick-view-window",children:[s.jsx("button",{className:"qv-close",onClick:x,"aria-label":b("close"),children:"×"}),s.jsxs("div",{className:"qv-body",children:[s.jsxs("div",{className:"qv-media",style:{position:"relative"},children:[s.jsx(Q,{src:e.image,alt:q,sizes:"(max-width: 768px) 90vw, 420px"}),k&&s.jsxs("span",{style:{position:"absolute",top:10,right:10,background:"#69be3c",color:"#fff",padding:"6px 10px",borderRadius:10,fontSize:12,fontWeight:600},children:["-",j,"%"]}),d&&s.jsx("span",{style:{position:"absolute",top:10,left:10,background:"rgba(0,0,0,.7)",color:"#fff",padding:"6px 10px",borderRadius:10,fontSize:12},children:i==="ar"?"غير متوفر":"Out of stock"})]}),s.jsxs("div",{className:"qv-info",children:[s.jsx("h2",{children:q}),s.jsx("p",{children:y(e?.short??e?.shortDescription??e?.description,i)}),v&&v.length>0&&s.jsx("div",{className:"qv-options",style:{marginTop:8},children:v.map(t=>s.jsxs("div",{style:{marginBottom:8},children:[s.jsx("div",{style:{fontSize:12,opacity:.8,marginBottom:6},children:y(t.name,i)||t.name}),s.jsx("div",{className:"flex gap-2 flex-wrap",children:(t.values||[]).map(a=>{const o=y(a,i)||String(a),M=String(u[t.name])===String(a);return s.jsx("button",{className:`px-3 py-1 rounded-full ${M?"bg-emerald-600 text-white":"bg-slate-100 dark:bg-slate-800"}`,onClick:()=>P(O=>({...O,[t.name]:a})),children:o},a)})})]},t.name))}),s.jsxs("div",{className:"qv-price",style:{display:"flex",alignItems:"center",gap:10},children:[s.jsxs("span",{className:"new",style:{fontWeight:700,fontSize:18,color:"#69be3c"},children:[Number(A||0).toFixed(2)," ",i==="ar"?"ر.س":"SAR"]}),w&&s.jsx("span",{className:"old",style:{textDecoration:"line-through",color:"#64748b"},children:Number(w).toFixed(2)}),k&&j&&s.jsxs("span",{style:{background:"#fde68a",color:"#92400e",padding:"4px 8px",borderRadius:8,fontSize:12},children:["-",j,"%"]})]}),s.jsxs("div",{style:{fontSize:12,color:"#475569",marginTop:6},children:[r?.sku&&s.jsxs("span",{style:{marginRight:10},children:["SKU: ",r.sku]}),s.jsxs("span",{children:[d?i==="ar"?"غير متوفر":"Out of stock":i==="ar"?"متوفر":"In stock",(r?.stock??e.stock)!=null?` · ${r?.stock??e.stock}`:""]})]}),s.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center",marginTop:12},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[s.jsx("button",{className:"qv-qty-btn",onClick:()=>N(t=>Math.max(1,t-1)),disabled:m<=1,children:"-"}),s.jsx("div",{style:{minWidth:36,textAlign:"center"},children:m}),s.jsx("button",{className:"qv-qty-btn",onClick:()=>N(t=>Math.min(t+1,(r?.stock??e.stock)||h||99)),disabled:m>=(r?.stock??e.stock)||m>=(h||99),children:"+"})]}),s.jsx("button",{className:`add-btn ${g==="added"?"added":""} ${g==="max"?"at-max":""}`,disabled:d||c,style:d||c?{opacity:.6,cursor:"not-allowed"}:null,onClick:()=>{if(d||c)return;const t=r?{...e,variantId:r.id}:e,a=I(t,m);if(a?.ok){const o=f+m>=(h||10);p(o?"max":"added"),setTimeout(()=>p(o?"max":"idle"),1300)}else if(a?.reason==="AUTH_REQUIRED"){const o=S.pathname+(S.search||"");E("/login",{state:{from:o}})}},children:d?i==="ar"?"غير متوفر":"Out of stock":c?i==="ar"?"الحد الأقصى":"Max":g==="added"?i==="ar"?"✓ تمت الإضافة":"✓ Added":b&&b("addToCart")}),f>0&&s.jsxs("span",{style:{fontSize:12,color:"#475569"},children:["(",i==="ar"?"في السلة":"In cart",": ",f,")"]}),s.jsx("button",{onClick:x,className:"btn-secondary",style:{fontSize:12},children:i==="ar"?"إغلاق":"Close"})]})]})]})]})}),document.body)};export{F as Q};
