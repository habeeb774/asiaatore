const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vendor.leaflet-Dl6I9sMh.js","assets/vendor-CKneRQof.js","assets/vendor.react-BIXKTxlu.js","assets/vendor.router-BdFOcp8q.js","assets/vendor.i18next-COqwnjR1.js","assets/vendor.zustand-BuMo4m-J.js","assets/vendor.tanstack-K6OTystZ.js"])))=>i.map(i=>d[i]);
import{_ as R}from"./vendor.tanstack-K6OTystZ.js";import{r as i,j as a}from"./vendor.react-BIXKTxlu.js";function k({stops:l=[]}){const y=i.useRef(null),r=i.useRef(null),u=i.useRef(null),[E,v]=i.useState(!1),[o,h]=i.useState(null);return i.useEffect(()=>{let t=!1,d;if(!document.querySelector('link[href*="leaflet.css"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css",document.head.appendChild(e)}return R(()=>import("./vendor.leaflet-Dl6I9sMh.js").then(e=>e.l),__vite__mapDeps([0,1,2,3,4,5,6])).then(e=>{if(!t){d=e.default||e;try{r.current||(r.current=d.map(y.current,{scrollWheelZoom:!1}),d.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(r.current))}catch(p){console.warn("leaflet init",p)}}}).catch(e=>{console.warn("failed to load leaflet",e)}),()=>{t=!0;try{r.current&&(r.current.remove(),r.current=null)}catch{}}},[]),i.useEffect(()=>{let t=!1;async function d(){try{if(!l||l.length<2){u.current&&r.current&&(u.current.remove(),u.current=null),h(null);return}v(!0);const p=`https://router.project-osrm.org/route/v1/driving/${l.map(n=>`${n.lng},${n.lat}`).join(";")}?overview=full&geometries=geojson&steps=false&annotations=duration,distance&overview=full`,f=await(await fetch(p)).json();if(t)return;if(!f||f.code!=="Ok"||!f.routes||!f.routes.length){h({error:"لا يوجد نتيجة للمسار"});return}const c=f.routes[0],g=(await R(async()=>{const{default:n}=await import("./vendor.leaflet-Dl6I9sMh.js").then(s=>s.l);return{default:n}},__vite__mapDeps([0,1,2,3,4,5,6]))).default;if(!r.current)return;u.current&&(u.current.remove(),u.current=null);const L=c.geometry,_=g.geoJSON(L,{style:{color:"#1d4ed8",weight:5,opacity:.85}}),x=g.layerGroup();l.forEach((n,s)=>{const m=g.marker([n.lat,n.lng]);m.bindPopup(`<div style="min-width:120px"><strong>${n.label||"نقطة"}${s+1}</strong></div>`),x.addLayer(m)});const j=g.featureGroup([_,x]);_.addTo(r.current),x.addTo(r.current),u.current=j,r.current.fitBounds(j.getBounds(),{padding:[40,40]});let w=[];if(c.legs&&c.legs.length){let n=0;for(let s=0;s<c.legs.length;s++){const m=c.legs[s];n+=Math.round(m.duration),w.push({idx:s+1,duration:Math.round(m.duration),cum:n})}}h({distance:Math.round(c.distance),duration:Math.round(c.duration),legs:w})}catch(e){console.warn("route compute failed",e),t||h({error:"فشل حساب المسار"})}finally{t||v(!1)}}return d(),()=>{t=!0}},[l]),a.jsxs("div",{className:"route-planner",children:[a.jsx("div",{ref:y,className:"h-64 bg-gray-50 rounded mb-2"}),a.jsxs("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("div",{className:"text-sm text-gray-600",children:l&&l.length?`${l.length} نقاط`:"اختر نقاطاً على لوحة الطلبات لإظهار المسار"}),a.jsxs("div",{className:"text-sm text-gray-700",children:[E&&"حساب المسار...",o&&!o.error&&a.jsxs("span",{children:["المدة: ",Math.round((o.duration||0)/60)," د، المسافة: ",(o.distance||0)/1e3," كم"]}),o&&o.error&&a.jsx("span",{className:"text-red-600",children:o.error})]})]}),o&&o.legs&&a.jsx("ol",{className:"mt-2 text-sm list-decimal list-inside",children:o.legs.map(t=>a.jsxs("li",{children:["مرحلة ",t.idx,": ",Math.round(t.duration/60)," د (إجمالي ",Math.round(t.cum/60)," د)"]},t.idx))})]})}export{k as R};
