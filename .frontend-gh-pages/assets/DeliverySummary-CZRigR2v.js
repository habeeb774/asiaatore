import{r as s,j as e}from"./vendor.react-C0fmYGW5.js";import{R as j}from"./RoutePlanner-Ds5jK6F4.js";import"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";function p(){const t=s.useRef(null),[a,n]=s.useState(!1),[c,r]=s.useState(!1),[l,d]=s.useState(null);s.useEffect(()=>{const i=!!window.BarcodeDetector;n(i)},[]);async function o(){try{const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});if(t.current&&(t.current.srcObject=i),r(!0),window.BarcodeDetector){const x=new window.BarcodeDetector({formats:["qr_code","code_128","ean_13"]}),h=async()=>{if(c){try{const f=await x.detect(t.current);f&&f.length&&d(f[0].rawValue)}catch{}requestAnimationFrame(h)}};h()}}catch(i){console.warn("camera denied",i)}}function m(){r(!1);try{const i=t.current?.srcObject;i&&i.getTracks&&i.getTracks().forEach(x=>x.stop()),t.current&&(t.current.srcObject=null)}catch{}}return e.jsxs("div",{children:[!a&&e.jsx("div",{className:"p-3 bg-yellow-50 rounded text-sm",children:"ماسح الباركود غير مدعوم في هذا المتصفح. يمكنك تحميل صورة أو إدخال الرقم يدوياً."}),e.jsx("div",{className:"mt-2",children:e.jsx("video",{ref:t,className:"w-full h-48 bg-black rounded",autoPlay:!0,muted:!0,playsInline:!0})}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[c?e.jsx("button",{className:"btn",onClick:m,children:"إيقاف"}):e.jsx("button",{className:"btn btn-primary",onClick:o,children:"بدء المسح"}),e.jsx("button",{className:"btn",onClick:()=>d(null),children:"مسح"})]}),e.jsxs("div",{className:"mt-2 text-sm",children:["الرمز: ",e.jsx("strong",{children:l??"-"})]})]})}function b({thresholdMinutes:t=120}){const[a,n]=s.useState(!1),[c,r]=s.useState(0),l=s.useRef(null);return s.useEffect(()=>(a&&(l.current=setInterval(()=>{r(d=>d+1)},60*1e3)),()=>{l.current&&clearInterval(l.current)}),[a]),s.useEffect(()=>{if(c>=t)try{window.Notification&&Notification.permission==="granted"&&new Notification("تنبيه سلامة",{body:"حان الوقت لأخذ استراحة قصيرة."})}catch{}},[c,t]),e.jsxs("div",{className:"p-3 bg-white rounded shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"مهلة القيادة الحالية"}),e.jsxs("div",{className:"text-lg font-semibold",children:[Math.floor(c)," دقيقة"]})]}),e.jsxs("div",{className:"flex gap-2",children:[a?e.jsx("button",{className:"btn",onClick:()=>n(!1),children:"أوقف"}):e.jsx("button",{className:"btn btn-primary",onClick:()=>n(!0),children:"ابدأ"}),e.jsx("button",{className:"btn",onClick:()=>r(0),children:"إعادة ضبط"})]})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["سيتلقى السائق تنبيهًا بعد ",t," دقيقة."]})]})}function R(){const[t,a]=s.useState(null),[n,c]=s.useState("day"),[r,l]=s.useState(!1);s.useEffect(()=>{let o=!1;return l(!0),fetch(`/api/delivery/summary?range=${n}`).then(m=>{if(!m.ok)throw new Error("no-summary");return m.json()}).then(m=>{o||a(m)}).catch(()=>{o||a({completed:0,rejected:0,failedAttempts:0,revenue:0})}).finally(()=>{o||l(!1)}),()=>o=!0},[n]);const d=s.useMemo(()=>t?Math.max(0,t.completed*10-t.rejected*5+Math.floor((t.revenue||0)/100)):0,[t]);return e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"ملخص الرحلة"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:`px-3 py-1 rounded ${n==="day"?"bg-primary-600 text-white":"bg-gray-100"}`,onClick:()=>c("day"),children:"اليوم"}),e.jsx("button",{className:`px-3 py-1 rounded ${n==="week"?"bg-primary-600 text-white":"bg-gray-100"}`,onClick:()=>c("week"),children:"الأسبوع"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(u,{label:"المنجز",value:r?"...":t?.completed??"-"}),e.jsx(u,{label:"مرفوض",value:r?"...":t?.rejected??"-"}),e.jsx(u,{label:"محاولات فاشلة",value:r?"...":t?.failedAttempts??"-"}),e.jsx(u,{label:"الإيراد",value:r?"...":`${t?.revenue??"-"} SAR`})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"لوحة الأداء"}),e.jsxs("div",{className:"p-4 bg-white rounded shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"النقاط المكتسبة"}),e.jsx("div",{className:"text-2xl font-bold",children:d})]}),e.jsx("div",{children:e.jsx("a",{href:"#rewards",className:"text-primary-600",children:"عرض المكافآت"})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-2",children:"تخطيط المسار"}),e.jsx(j,{})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"ماسح الباركود"}),e.jsx(p,{})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"مساعد السلامة"}),e.jsx(b,{})]})]})]})}function u({label:t,value:a}){return e.jsxs("div",{className:"p-4 bg-white rounded shadow-sm text-center",children:[e.jsx("div",{className:"text-sm text-gray-500",children:t}),e.jsx("div",{className:"text-xl font-semibold",children:a})]})}export{R as default};
