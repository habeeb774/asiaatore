import{R as n,j as s,L as _}from"./vendor.react-C0fmYGW5.js";import{g as $,f as R,c as q,u as E,h as I,S as T}from"./index-B0cb22ux.js";import"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";/* empty css                     */const V=()=>{const{orders:v=[],loading:L,error:k,useRemote:M,refresh:A}=$()||{},{user:b}=R()||{},{setting:D}=q()||{},{locale:N}=E(),f=N==="ar"?D?.siteNameAr||"شركة منفذ اسيا التجارية":D?.siteNameEn||"My Store",F=(N==="ar"?"الطلبات":"Orders")+" | "+f,[i,m]=n.useState(""),[d,h]=n.useState(""),[c,g]=n.useState(""),[r,j]=n.useState(""),[p,y]=n.useState(""),[o,w]=n.useState(1),C=20,u=n.useMemo(()=>{let a=b?.role==="admin"?v:v.filter(t=>String(t.userId)===String(b?.id||"guest"));const l=p.trim().toLowerCase();if(l&&(a=a.filter(t=>(t.id+"").toLowerCase().includes(l)||(t.userId||"").toLowerCase().includes(l)||(""+(t.total??t.grandTotal??0)).includes(l))),i&&(a=a.filter(t=>t.status===i)),d&&(a=a.filter(t=>(t.paymentMethod||"")===d)),c){const t=new Date(c);isNaN(t)||(a=a.filter(x=>new Date(x.createdAt)>=t))}if(r){const t=new Date(r);isNaN(t)||(r.match(/^\d{4}-\d{2}-\d{2}$/)&&t.setHours(23,59,59,999),a=a.filter(x=>new Date(x.createdAt)<=t))}return a=[...a].sort((t,x)=>new Date(x.createdAt)-new Date(t.createdAt)),a},[v,b,i,d,c,r,p]),S=Math.ceil(u.length/C)||1,O=n.useMemo(()=>u.slice((o-1)*C,o*C),[u,o]);return n.useEffect(()=>{w(1)},[i,d,c,r,p]),L?s.jsxs("div",{className:"container-custom px-4 py-12","aria-busy":"true","aria-live":"polite",children:[s.jsx("div",{className:"mb-4 flex gap-2 justify-center flex-wrap text-sm opacity-70",children:"جار التحميل..."}),s.jsx(I,{rows:8,cols:4})]}):k?s.jsxs("div",{className:"container-custom px-4 py-12 text-center text-sm text-red-600",children:["خطأ: ",k]}):u.length===0?s.jsxs("div",{className:"container-custom px-4 py-12 text-center",children:[s.jsxs("div",{className:"mb-4 flex gap-2 justify-center flex-wrap text-sm",children:[s.jsx("input",{placeholder:"بحث (رقم الطلب / المستخدم / المبلغ)",value:p,onChange:e=>y(e.target.value),className:"px-3 py-2 border rounded"}),s.jsxs("select",{value:i,onChange:e=>m(e.target.value),className:"px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"كل الحالات"}),["pending","processing","pending_bank_review","paid","shipped","completed","cancelled"].map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{value:d,onChange:e=>h(e.target.value),className:"px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"كل الطرق"}),["paypal","bank","cod","stc"].map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsx("input",{type:"date",value:c,onChange:e=>g(e.target.value),className:"px-3 py-2 border rounded"}),s.jsx("input",{type:"date",value:r,onChange:e=>j(e.target.value),className:"px-3 py-2 border rounded"}),s.jsx("button",{onClick:()=>{y(""),m(""),h(""),g(""),j("")},className:"btn-secondary px-3 py-2",children:"مسح الفلاتر"}),s.jsx("button",{onClick:()=>A?.(),className:"btn-secondary px-3 py-2",children:"تحديث"})]}),"لا توجد طلبات"]}):s.jsxs("div",{className:"container-custom px-4 py-8","aria-live":"polite",children:[s.jsx(T,{title:F,description:N==="ar"?`قائمة الطلبات - ${f}`:`Orders - ${f}`}),s.jsxs("h2",{className:"text-2xl font-bold mb-6",children:["الطلبات (",u.length,") ",!M&&s.jsx("span",{className:"text-xs text-yellow-700 bg-yellow-100 px-2 py-1 rounded",children:"وضع محلي"})]}),s.jsxs("div",{className:"mb-4 flex gap-2 flex-wrap items-center text-sm",children:[s.jsx("input",{placeholder:"بحث (رقم الطلب / المستخدم / المبلغ)",value:p,onChange:e=>y(e.target.value),className:"px-3 py-2 border rounded"}),s.jsxs("select",{value:i,onChange:e=>m(e.target.value),className:"px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"كل الحالات"}),["pending","processing","pending_bank_review","paid","shipped","completed","cancelled"].map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{value:d,onChange:e=>h(e.target.value),className:"px-3 py-2 border rounded",children:[s.jsx("option",{value:"",children:"كل الطرق"}),["paypal","bank","cod","stc"].map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsx("input",{type:"date",value:c,onChange:e=>g(e.target.value),className:"px-3 py-2 border rounded"}),s.jsx("input",{type:"date",value:r,onChange:e=>j(e.target.value),className:"px-3 py-2 border rounded"}),s.jsx("button",{onClick:()=>{y(""),m(""),h(""),g(""),j("")},className:"btn-secondary px-3 py-2",children:"مسح الفلاتر"}),s.jsx("button",{onClick:()=>A?.(),className:"btn-secondary px-3 py-2",children:"تحديث"})]}),s.jsx("div",{className:"space-y-4",children:O.map(e=>s.jsxs("div",{className:"p-4 border rounded flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsxs("div",{className:"font-semibold",children:["#",e.id]}),s.jsxs("div",{className:"text-sm text-gray-600",children:["المستخدم: ",e.userId," — ",new Date(e.createdAt).toLocaleString()]}),s.jsxs("div",{className:"text-sm",children:["العناصر: ",(e.items||[]).length]})]}),s.jsxs("div",{className:"text-right",children:[s.jsxs("div",{className:"mb-2",children:["الإجمالي: ",s.jsxs("strong",{children:[e.total||(e.items||[]).reduce((a,l)=>a+(l.price||0)*(l.quantity||1),0)," ر.س"]})]}),s.jsxs("div",{className:"flex gap-2 justify-end flex-wrap",children:[s.jsx(_,{to:`/order/${e.id}`,className:"btn-secondary px-4 py-2",children:"عرض"}),s.jsx("a",{href:`/api/orders/${e.id}/invoice`,target:"_blank",rel:"noopener",className:"btn-secondary px-4 py-2",children:"فاتورة"})]})]})]},e.id))}),S>1&&s.jsxs("div",{className:"mt-8 flex justify-center gap-2 text-sm",children:[s.jsx("button",{disabled:o===1,onClick:()=>w(e=>e-1),className:"btn-secondary px-3 py-1 disabled:opacity-40",children:"السابق"}),s.jsxs("span",{className:"px-2",children:[o," / ",S]}),s.jsx("button",{disabled:o===S,onClick:()=>w(e=>e+1),className:"btn-secondary px-3 py-1 disabled:opacity-40",children:"التالي"})]})]})};export{V as default};
