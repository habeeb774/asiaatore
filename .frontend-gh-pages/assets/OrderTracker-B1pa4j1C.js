import{a7 as x,r as d,j as e}from"./vendor.react-C0fmYGW5.js";import{b as p}from"./index-Df3LzoMm.js";import"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";/* empty css                     */function L(){const{id:l}=x(),[r,n]=d.useState(null),[o,m]=d.useState([]),u=d.useRef(null);return d.useEffect(()=>{let t=!0;return(async()=>{try{const a=await p.getOrder(l);t&&n(a.order||a)}catch{}})(),()=>{t=!1}},[l]),d.useEffect(()=>{const t=new EventSource("/api/events");u.current=t;const a=c=>v=>{try{const i=JSON.parse(v.data);i&&i.orderId===l&&(m(s=>[{t:Date.now(),type:c,data:i},...s].slice(0,200)),c==="delivery.updated"&&n(s=>({...s||{},deliveryStatus:i.deliveryStatus,deliveredAt:i.deliveredAt||s&&s.deliveredAt})),c==="delivery.location"&&n(s=>({...s||{},deliveryLocation:i.location})),c==="order.updated"&&n(s=>({...s||{},status:i.status||s&&s.status})))}catch{}};return t.addEventListener("delivery.updated",a("delivery.updated")),t.addEventListener("delivery.location",a("delivery.location")),t.addEventListener("order.updated",a("order.updated")),()=>{t.close()}},[l]),r?e.jsxs("div",{className:"container-custom p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"تتبع الطلب"}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700",children:["رقم الطلب: ",r.id]}),e.jsxs("div",{className:"mb-2",children:["حالة الطلب: ",e.jsx("span",{className:"font-semibold",children:r.status})]}),e.jsxs("div",{className:"mb-2",children:["حالة التوصيل: ",e.jsx("span",{className:"font-semibold",children:r.deliveryStatus||"—"})]}),r.deliveryLocation&&e.jsxs("div",{className:"mb-2 text-sm",children:["الموقع الحالي: lat ",r.deliveryLocation.lat,", lng ",r.deliveryLocation.lng]}),r.deliveredAt&&e.jsxs("div",{className:"text-sm",children:["سُلّم في: ",new Date(r.deliveredAt).toLocaleString("ar")]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"أحداث حية"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[o.map((t,a)=>e.jsxs("li",{children:["[",new Date(t.t).toLocaleTimeString(),"] ",t.type," → ",JSON.stringify(t.data)]},a)),o.length===0&&e.jsx("li",{className:"text-gray-500",children:"لا توجد أحداث بعد"})]})]})]}):e.jsx("div",{className:"container-custom p-4",children:"تحميل الطلب..."})}export{L as default};
