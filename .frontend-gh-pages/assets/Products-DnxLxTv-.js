import{j as e,aa as T,ab as E,K as G,J as Y,R as J,L as _,u as H,r as d}from"./vendor.react-C0fmYGW5.js";import{u as z,c as V,S as W}from"./index-B0cb22ux.js";import{P as X,a as Z}from"./ProductGridSkeleton-2gkZqysE.js";import"./vendor-CF_-ATCh.js";import"./vendor.router-2GzHiivc.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-U7UpOlxs.js";/* empty css                     */import"./QuickViewModal-CpkSfHrV.js";import"./LazyImage-SqLtajCp.js";const U=({state:s,onChange:a,sidebar:o=!1})=>{const{locale:p}=z(),n=p==="ar",l=r=>a({...s,...r}),h=()=>a({...s,sort:"new",min:"",max:"",rating:"",discount:!1}),x=!!(s.min||s.max||s.rating||s.discount),v=o?"grid grid-cols-1 gap-2 md:gap-2.5 sticky top-30":"w-full";return e.jsxs("div",{className:"product-filters "+v,children:[o&&e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:[n?"تصفية النتائج":"Filter results",x?e.jsx("span",{className:"ms-1 inline-block rounded-full bg-slate-100 px-1.5 py-0.5 text-[10px] text-slate-600",children:n?"مفعّل":"Active"}):null]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-1 text-[11px] text-sky-700 hover:text-sky-800",children:[e.jsx(T,{className:"size-3"})," ",n?"إعادة ضبط":"Reset"]})]}),!o&&e.jsxs("div",{role:"toolbar","aria-label":n?"شريط تصفية المنتجات":"Products filter toolbar",className:"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white/80 p-2 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-white/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"sort",className:"sr-only",children:n?"الترتيب":"Sort"}),e.jsxs("select",{id:"sort",value:s.sort,onChange:r=>l({sort:r.target.value}),className:"h-8 min-w-[8rem] rounded-md border border-slate-200 bg-white px-2 text-xs",children:[e.jsx("option",{value:"new",children:n?"الأحدث":"Newest"}),e.jsx("option",{value:"price-asc",children:n?"السعر ↑":"Price ↑"}),e.jsx("option",{value:"price-desc",children:n?"السعر ↓":"Price ↓"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[11px] text-slate-600",children:n?"السعر":"Price"}),e.jsx("input",{type:"number",min:"0",value:s.min||"",onChange:r=>l({min:r.target.value}),placeholder:n?"من":"Min",className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:n?"إلى":"to"}),e.jsx("input",{type:"number",min:"0",value:s.max||"",onChange:r=>l({max:r.target.value}),placeholder:n?"أقصى":"Max",className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"rating",className:"sr-only",children:n?"التقييم":"Rating"}),e.jsxs("select",{id:"rating",value:s.rating||"",onChange:r=>l({rating:r.target.value}),className:"h-8 min-w-[7rem] rounded-md border border-slate-200 bg-white px-2 text-xs",children:[e.jsx("option",{value:"",children:n?"الكل":"All"}),[5,4,3,2,1].map(r=>e.jsx("option",{value:r,children:n?`على الأقل ${r}`:`≥ ${r}`},r))]})]}),e.jsxs("label",{className:"ms-auto inline-flex items-center gap-2 rounded-md bg-slate-50 px-2 py-1 text-xs text-slate-800",children:[e.jsx("span",{children:n?"خصم":"Discount"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"discount",type:"checkbox",checked:!!s.discount,onChange:r=>l({discount:r.target.checked}),className:"peer sr-only"}),e.jsx("span",{className:"block h-4 w-8 rounded-full bg-slate-300 peer-checked:bg-sky-600 transition-colors",children:e.jsx("span",{className:"block h-3.5 w-3.5 translate-x-0.5 translate-y-0.5 rounded-full bg-white shadow transition-transform peer-checked:translate-x-[14px]"})})]})]}),e.jsxs("button",{type:"button",onClick:h,className:"inline-flex items-center gap-1.5 rounded-md border border-slate-200 bg-slate-50 px-2.5 py-1.5 text-xs text-slate-700 hover:bg-slate-100",children:[e.jsx(T,{className:"size-3.5"})," ",n?"إعادة ضبط":"Reset"]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:n?"الترتيب":"Sort"}),e.jsx(E,{className:"size-1.5 transition-transform group-open:rotate-180"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{id:"sort",value:s.sort,onChange:r=>l({sort:r.target.value}),className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs",children:[e.jsx("option",{value:"new",children:n?"الأحدث":"Newest"}),e.jsx("option",{value:"price-asc",children:n?"السعر ↑":"Price ↑"}),e.jsx("option",{value:"price-desc",children:n?"السعر ↓":"Price ↓"})]})})]}),e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:n?"السعر":"Price"}),e.jsx(E,{className:"size-3.5 transition-transform group-open:rotate-180"})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-1.5",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[11px] text-slate-500",children:n?"من":"Min"}),e.jsx("input",{type:"number",min:"0",value:s.min||"",onChange:r=>l({min:r.target.value}),placeholder:n?"أدنى":"Min",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[11px] text-slate-500",children:n?"إلى":"Max"}),e.jsx("input",{type:"number",min:"0",value:s.max||"",onChange:r=>l({max:r.target.value}),placeholder:n?"أقصى":"Max",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]})]})]}),e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:n?"التقييم":"Rating"}),e.jsx(E,{className:"size-3.5 transition-transform group-open:rotate-180"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:s.rating||"",onChange:r=>l({rating:r.target.value}),className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs",children:[e.jsx("option",{value:"",children:n?"الكل":"All"}),[5,4,3,2,1].map(r=>e.jsx("option",{value:r,children:n?`على الأقل ${r}`:`≥ ${r}`},r))]})})]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm",children:e.jsxs("label",{className:"flex items-center justify-between gap-2 text-xs text-slate-800",children:[e.jsx("span",{children:n?"خصم":"Discount"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"discount",type:"checkbox",checked:!!s.discount,onChange:r=>l({discount:r.target.checked}),className:"peer sr-only"}),e.jsx("span",{className:"block h-4 w-8 rounded-full bg-slate-300 peer-checked:bg-sky-600 transition-colors",children:e.jsx("span",{className:"block h-3.5 w-3.5 translate-x-0.5 translate-y-0.5 rounded-full bg-white shadow transition-transform peer-checked:translate-x-[14px]"})})]})]})})]})]})},ee=typeof import.meta<"u"&&"https://my-store-backend-production.up.railway.app/api"||"/api",te=(s={})=>Object.entries(s).filter(([,a])=>a!=null&&a!=="").map(([a,o])=>Array.isArray(o)?o.map(p=>`${encodeURIComponent(a)}=${encodeURIComponent(p)}`).join("&"):`${encodeURIComponent(a)}=${encodeURIComponent(o)}`).join("&");async function I(s,a,{signal:o}={}){const p=a?`?${te(a)}`:"",n=await fetch(`${ee}${s}${p}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"},signal:o});if(!n.ok){const l=await n.json().catch(()=>({})),h=new Error(l.message||`Request failed: ${n.status}`);throw h.status=n.status,h.body=l,h}return n.json()}const K=s=>["products",{...s}];async function O({queryKey:s,signal:a}){const[,o]=s;return I("/products",o,{signal:a})}function se(s){return G({queryKey:K(s),queryFn:O,placeholderData:a=>a})}const re=s=>["product",s];async function ae({queryKey:s,signal:a}){const[,o]=s;return I(`/products/${o}`,void 0,{signal:a})}function ne(){const s=Y();return a=>s.prefetchQuery({queryKey:re(a),queryFn:ae,staleTime:6e4})}function ie(s,a){const o=Y();return()=>{if(!a)return;const p={...s,page:(Number(s?.page)||1)+1};return o.prefetchQuery({queryKey:K(p),queryFn:O,staleTime:6e4})}}const ce=({items:s=[],className:a=""})=>!Array.isArray(s)||!s.length?null:e.jsx("nav",{className:`text-sm text-gray-500 mb-3 ${a}`,"aria-label":"breadcrumb",children:e.jsx("ol",{className:"flex items-center gap-2",children:s.map((o,p)=>e.jsxs(J.Fragment,{children:[p>0&&e.jsx("li",{"aria-hidden":!0,children:"›"}),e.jsx("li",{children:o.to?e.jsx(_,{to:o.to,className:"hover:text-primary-red",children:o.label}):e.jsx("span",{className:"text-gray-700",children:o.label})})]},p))})}),ye=()=>{const s=H(),{locale:a}=z(),{setting:o}=V()||{},p=a==="ar"?o?.siteNameAr||"شركة منفذ اسيا التجارية":o?.siteNameEn||"My Store",n=a==="ar"?`المنتجات | ${p}`:`${p} | Products`,l=d.useMemo(()=>({q:new URLSearchParams(s.search).get("q")||void 0,category:new URLSearchParams(s.search).get("category")||void 0}),[s.search]),h=12,[x,v]=d.useState({...l,page:1,pageSize:h}),{data:r,isLoading:S,isFetching:$,error:C,refetch:R}=se(x);ne();const[c,w]=d.useState({q:l.q||"",category:l.category||"",sort:"new",min:"",max:"",rating:"",discount:!1,page:1}),P=d.useRef(null);d.useEffect(()=>{v(t=>({...t,...l,page:1}))},[l.q,l.category]),d.useEffect(()=>(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{v(t=>({...t,page:1,pageSize:h,q:c.q||void 0,category:c.category||void 0,minPrice:c.min||void 0,maxPrice:c.max||void 0}))},300),()=>{P.current&&clearTimeout(P.current)}),[c.q,c.category,c.min,c.max]),d.useEffect(()=>{Number(c.page)!==Number(x.page)&&w(t=>({...t,page:Number(x.page)||1}))},[x.page]),d.useEffect(()=>{const t=new URLSearchParams(window.location.search),i={};["category","sort","min","max","rating","discount","page"].forEach(m=>{t.has(m)&&(i[m]=t.get(m))}),i.discount!=null&&(i.discount=String(i.discount)==="true"),i.page!=null&&(i.page=+i.page||1);const u={...c,...i};JSON.stringify(u)===JSON.stringify(c)||w(u)},[s.search]),d.useEffect(()=>{const t=new URLSearchParams;Object.entries(c).forEach(([f,m])=>{m!==""&&m!==!1&&m!=null&&t.set(f,m)});const i=t.toString(),u=window.location.pathname+(i?`?${i}`:"");window.location.search!==(i?`?${i}`:"")&&window.history.replaceState({},"",u)},[c]);const[M,A]=d.useState([]);d.useEffect(()=>{const t=Array.isArray(r)?r:Array.isArray(r?.items)?r.items:[];Number(r?.page||x.page||1)<=1?A(t||[]):t&&t.length&&A(u=>{const f=new Set(u.map(j=>j.id)),m=t.filter(j=>!f.has(j.id));return u.concat(m)})},[r?.items,r,x.page]);const b=d.useMemo(()=>{let t=M.slice();return c.category&&(t=t.filter(i=>i.category===c.category)),c.min&&(t=t.filter(i=>+i.price>=+c.min)),c.max&&(t=t.filter(i=>+i.price<=+c.max)),c.rating&&(t=t.filter(i=>(i.rating||0)>=+c.rating)),c.discount&&(t=t.filter(i=>{const u=i.oldPrice??i.originalPrice,f=u!=null?+u:NaN,m=i.price!=null?+i.price:NaN;return Number.isFinite(f)&&Number.isFinite(m)&&f>m})),c.sort==="price-asc"&&t.sort((i,u)=>+i.price-+u.price),c.sort==="price-desc"&&t.sort((i,u)=>+u.price-+i.price),t},[c,M]),Q=r?.total??(Array.isArray(r)?r.length:r?.items?.length||0),k=Math.max(1,Math.ceil(Q/h)),y=Number(r?.page||c.page||1),N=b.slice(0,y*h);d.useEffect(()=>{c.page!==y&&w(t=>({...t,page:y}))},[y]);const D=ie(x,y<k);d.useEffect(()=>{if(y<k)try{D()}catch{}},[y,k,x.q,x.category,x.minPrice,x.maxPrice]);const[B,q]=d.useState(!1),F=d.useRef(null),g=d.useRef({startY:0,pulling:!1,offset:0});return d.useEffect(()=>{const t=F.current;if(!t)return;const i=60,u=j=>{window.scrollY>0||(g.current.startY=j.touches[0].clientY,g.current.pulling=!0,g.current.offset=0)},f=j=>{if(!g.current.pulling)return;const L=j.touches[0].clientY-g.current.startY;L>0&&window.scrollY<=0&&(g.current.offset=Math.min(100,L*.6),t.style.transform=`translateY(${g.current.offset}px)`)},m=async()=>{if(!g.current.pulling)return;const j=g.current.offset>i;if(t.style.transition="transform 180ms ease",t.style.transform="translateY(0)",setTimeout(()=>{t.style.transition=""},220),g.current.pulling=!1,g.current.offset=0,j)try{await R()}catch{}};return t.addEventListener("touchstart",u,{passive:!0}),t.addEventListener("touchmove",f,{passive:!0}),t.addEventListener("touchend",m,{passive:!0}),()=>{t.removeEventListener("touchstart",u),t.removeEventListener("touchmove",f),t.removeEventListener("touchend",m)}},[R]),e.jsxs("div",{ref:F,className:"offers-page catalog-page container-custom px-4 py-8",style:{willChange:"transform",touchAction:"pan-x pan-y"},children:[e.jsx(W,{title:n,description:a==="ar"?"المنتجات":"Products"}),e.jsx(ce,{items:[{label:a==="ar"?"الرئيسية":"Home",to:"/"},{label:a==="ar"?"المنتجات":"Products"}]}),e.jsx("h1",{className:"page-title mb-4",children:a==="ar"?"المنتجات":"Products"}),e.jsx("div",{className:"md:hidden mb-3 flex justify-between items-center",children:e.jsx("div",{className:"text-xs text-gray-600",children:a==="ar"?`عرض ${Math.min(N.length,b.length)} من ${b.length}`:`Showing ${Math.min(N.length,b.length)} of ${b.length}`})}),B&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>q(!1)}),e.jsxs("div",{className:"absolute inset-y-0 start-0 w-[86vw] max-w-[360px] bg-white p-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold",children:a==="ar"?"الفلاتر":"Filters"}),e.jsx("button",{className:"text-sm",onClick:()=>q(!1),children:a==="ar"?"إغلاق":"Close"})]}),e.jsx(U,{state:c,onChange:w,sidebar:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("section",{children:[e.jsx("div",{className:"hidden md:block mb-3 md:sticky md:top-24 z-10",children:e.jsx(U,{state:c,onChange:w})}),e.jsxs("div",{className:"flex items-center justify-between mb-3 text-sm text-gray-600",children:[e.jsx("div",{children:a==="ar"?`عرض ${Math.min(N.length,b.length)} من ${b.length}`:`Showing ${Math.min(N.length,b.length)} of ${b.length}`}),e.jsx("div",{className:"text-xs text-gray-400","aria-hidden":"true",children:$?a==="ar"?"تحديث...":"Refreshing...":a==="ar"?"اسحب للأسفل للتحديث":"Pull down to refresh"})]}),S&&e.jsx(X,{count:h}),C&&e.jsx("p",{className:"text-red-600 text-sm",children:a==="ar"?"فشل التحميل":"Failed to load products."}),!S&&!C&&N.length===0&&e.jsx("p",{children:a==="ar"?"لا توجد نتائج":"No results"}),!S&&!C&&N.length>0&&e.jsx(Z,{products:N}),y<k&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{className:"btn-primary px-4 py-2",onClick:()=>{v(t=>({...t,page:(Number(t.page)||1)+1})),w(t=>({...t,page:(Number(t.page)||1)+1}))},disabled:$,children:$?a==="ar"?"جارٍ التحميل...":"Loading...":a==="ar"?"تحميل المزيد":"Load more"})})]})})]})};export{ye as default};
