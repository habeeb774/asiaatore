import{E as e,N as t,O as n,P as r,T as i,_ as a,w as o,y as s}from"./index-HsKwDOAa.js";import{t as c}from"./ProductFilters-4vrLVmQF.js";import{t as l}from"./ProductGrid-DH-NILNo.js";var u=r(t()),d=r(e()),f=()=>{let{products:e,loading:t,error:r}=s(),{t:f,locale:p}=o(),{setting:m}=i()||{},h=p===`ar`?m?.siteNameAr||`متجري`:m?.siteNameEn||`My Store`,g=p===`ar`?`${f(`catalog`)} | ${h}`:`${h} | ${f(`catalog`)}`,[_,v]=(0,u.useState)({category:``,sort:`new`,min:``,max:``,rating:``,discount:!1,page:1}),[y,b]=(0,u.useState)([]);(0,u.useEffect)(()=>{let e=new URLSearchParams(window.location.search),t={};[`category`,`sort`,`min`,`max`,`rating`,`discount`,`page`].forEach(n=>{e.has(n)&&(t[n]=e.get(n))}),t.discount&&=t.discount===`true`,t.page&&=+t.page||1,Object.keys(t).length&&v(e=>({...e,...t}))},[]),(0,u.useEffect)(()=>{let e=!0;return n.listCategories({withCounts:1}).then(t=>{e&&t?.categories&&b(t.categories)}).catch(()=>{}),()=>{e=!1}},[]);let x=(0,u.useMemo)(()=>{let e=new Map;for(let t of y){let n=t.slug||t.id;e.has(n)||e.set(n,t)}return Array.from(e.values()).sort((e,t)=>(t.productCount||0)-(e.productCount||0)).slice(0,8)},[y]),S=p===`en`?`/en/catalog`:`/catalog`;(0,u.useEffect)(()=>{let e=new URLSearchParams;Object.entries(_).forEach(([t,n])=>{n!==``&&n!==!1&&n!=null&&e.set(t,n)});let t=e.toString(),n=window.location.pathname+(t?`?${t}`:``);window.history.replaceState({},``,n)},[_]);let C=(0,u.useMemo)(()=>{let t=[...e];return _.category&&(t=t.filter(e=>e.category===_.category)),_.min&&(t=t.filter(e=>+e.price>=+_.min)),_.max&&(t=t.filter(e=>+e.price<=+_.max)),_.rating&&(t=t.filter(e=>(e.rating||0)>=+_.rating)),_.discount&&(t=t.filter(e=>e.oldPrice&&e.oldPrice>e.price)),_.sort===`price-asc`&&t.sort((e,t)=>e.price-+t.price),_.sort===`price-desc`&&t.sort((e,t)=>t.price-+e.price),t},[_,e]),w=Math.max(1,Math.ceil(C.length/12)),T=Math.min(_.page,w),E=C.slice((T-1)*12,T*12);(0,u.useEffect)(()=>{_.page!==T&&v(e=>({...e,page:T}))},[T,_.page]);let D={"@context":`https://schema.org`,"@type":`BreadcrumbList`,itemListElement:[{"@type":`ListItem`,position:1,name:f(`breadcrumbHome`),item:`https://jomlah.app/`},{"@type":`ListItem`,position:2,name:f(`breadcrumbCatalog`),item:`https://jomlah.app`+(p===`ar`?`/catalog`:`/${p}/catalog`)}]};return r?(0,d.jsxs)(`div`,{style:{padding:`40px`},children:[(0,d.jsx)(`h2`,{children:`حدث خطأ في تحميل المنتجات`}),(0,d.jsx)(`p`,{style:{direction:`ltr`},children:r})]}):(0,d.jsxs)(`div`,{className:`catalog-page`,children:[(0,d.jsx)(a,{title:g,description:f(`catalog`)}),(0,d.jsx)(`script`,{type:`application/ld+json`,dangerouslySetInnerHTML:{__html:JSON.stringify(D)}}),(0,d.jsx)(`h1`,{className:`page-title`,children:f(`catalog`)}),x.length>0&&(0,d.jsx)(`section`,{className:`section-padding bg-white`,"aria-labelledby":`cats-head`,children:(0,d.jsxs)(`div`,{className:`container-custom`,children:[(0,d.jsxs)(`div`,{className:`home-section-head text-center`,children:[(0,d.jsx)(`h2`,{id:`cats-head`,className:`home-section-head__title`,children:p===`ar`?`تصفح حسب التصنيف`:`Browse by Category`}),(0,d.jsx)(`p`,{className:`home-section-head__subtitle`,children:p===`ar`?`اختيارات سريعة لأفضل الأقسام`:`Quick picks for top categories`})]}),(0,d.jsx)(`div`,{className:`featured-grid`,style:{gridTemplateColumns:`repeat(auto-fit,minmax(180px,1fr))`},children:x.map(e=>(0,d.jsx)(`div`,{children:(0,d.jsxs)(`a`,{href:`${S}?category=${encodeURIComponent(e.slug)}`,className:`block rounded-2xl bg-white shadow hover:shadow-2xl transition overflow-hidden`,children:[(0,d.jsx)(`div`,{style:{aspectRatio:`4/3`,background:`#f3f4f6`,display:`grid`,placeItems:`center`},children:e.image?(0,d.jsx)(`img`,{src:e.image,alt:e.name?.[p]||e.name?.ar||e.slug,style:{width:`100%`,height:`100%`,objectFit:`cover`}}):(0,d.jsx)(`span`,{style:{fontSize:`2rem`,fontWeight:800,color:`var(--color-primary)`},children:(e.name?.[p]||e.name?.ar||e.slug).toString().slice(0,2)})}),(0,d.jsxs)(`div`,{style:{padding:`10px 12px`,display:`flex`,justifyContent:`space-between`,alignItems:`center`},children:[(0,d.jsx)(`span`,{style:{fontWeight:700},children:p===`ar`?e.name?.ar||e.slug:e.name?.en||e.slug}),typeof e.productCount==`number`&&(0,d.jsx)(`span`,{style:{fontSize:12,opacity:.7},children:e.productCount})]})]})},e.id||e.slug))})]})}),(0,d.jsx)(c,{state:_,onChange:v}),t&&(0,d.jsx)(`p`,{style:{opacity:.7},children:p===`ar`?`جاري تحميل البيانات...`:`Loading products...`}),!t&&E.length===0&&(0,d.jsx)(`p`,{children:p===`ar`?`لا توجد نتائج`:`No results`}),!t&&E.length>0&&(0,d.jsx)(l,{products:E,wide:!0}),w>1&&(0,d.jsxs)(`div`,{className:`pagination`,style:{display:`flex`,gap:8,justifyContent:`center`,marginTop:24},children:[(0,d.jsx)(`button`,{disabled:T===1,onClick:()=>v(e=>({...e,page:e.page-1})),children:p===`ar`?`السابق`:`Prev`}),(0,d.jsx)(`span`,{style:{fontSize:13},children:p===`ar`?`صفحة ${T} من ${w}`:`Page ${T} of ${w}`}),(0,d.jsx)(`button`,{disabled:T===w,onClick:()=>v(e=>({...e,page:e.page+1})),children:p===`ar`?`التالي`:`Next`})]})]})};export{f as default};