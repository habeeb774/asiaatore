/* Modern compact sidebar theme */
.sidebar-modern {
  --sb-width: 200px;
  --sb-collapsed-width: 70px;
  --sb-bg: #0f172a;
  --sb-bg-alt: #16263a;
  --sb-border: #1e3147;
  /* Accent is themeable: inherits from --color-primary if provided */
  --sb-accent: var(--color-primary, #22c55e);
  /* Secondary accent for gradients */
  --sb-accent-2: var(--color-primary-2, #86efac);
  /* Active gradient token (can be overridden by themes) */
  --sidebar-active-gradient: linear-gradient(90deg,var(--sb-accent),var(--sb-accent-2));
  --sb-text: #f1f5f9;
  --sb-text-muted: #ebeff3;
  --sb-radius: 14px;
  --sb-radius-sm: 8px;
  --sb-scroll-track: transparent;
  /* Brand-aware thumb; fall back to subtle if brand rgb missing */
  --sb-scroll-thumb: rgba(var(--color-primary-rgb, 34,197,94), .28);
  --sb-shadow: 0 10px 28px -12px rgba(0,0,0,.55);
  --sb-focus-ring: rgba(var(--color-primary-rgb, 34,197,94), .35);
  --sb-gap: .55rem;
  position: relative;
  z-index: 1030;
  display: flex;
  flex-direction: column;
  width: var(--sb-width);
  min-height: 100vh; /* fills the shell height; inner nav handles scrolling */
  background: radial-gradient(circle at 20% 12%,#4daf18,#024817 62%);
  border-inline-end: 1px solid var(--sb-border);
  color: var(--sb-text);
  box-shadow: var(--sb-shadow);
  transition: width .35s cubic-bezier(.65,.05,.36,1);
  font-family: var(--font-sans, 'Cairo', 'Inter', sans-serif);
}
.sidebar-modern[data-collapsed='true'] { width: var(--sb-collapsed-width); }

.sidebar-modern__inner { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.sidebar-modern__head { display:flex; align-items:center; gap:.55rem; padding:.85rem .9rem .75rem; min-height:58px; }
.sidebar-modern__brand { font-size:.95rem; font-weight:600; letter-spacing:.5px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.sidebar-modern__toggle { margin-inline-start:auto; background:var(--sb-bg-alt); border:1px solid var(--sb-border); color:var(--sb-text); cursor:pointer; padding:.55rem .65rem; border-radius:var(--sb-radius-sm); font-size:.85rem; display:inline-flex; align-items:center; justify-content:center; gap:.35rem; line-height:1; min-width:38px; height:36px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.04); transition:background .25s, transform .25s ease, box-shadow .25s; }
.sidebar-modern__toggle:hover { background:#1b3146; }
.sidebar-modern__toggle:active { transform: scale(.98); }
.sidebar-modern__toggle:focus-visible { outline: none; box-shadow: 0 0 0 3px var(--sb-focus-ring), inset 0 0 0 1px rgba(255,255,255,.06); }
/* Rotate the toggle to hint state: desktop collapsed = flipped, mobile open = quarter turn */
.sidebar-modern[data-collapsed='true'] .sidebar-modern__toggle { transform: rotate(180deg); }
@media (max-width: 980px) {
  .sidebar-modern[data-open='true'] .sidebar-modern__toggle { transform: rotate(90deg); }
}

.sidebar-modern__nav { flex:1; overflow-y:auto; padding:.4rem .55rem 1.15rem; margin:0; list-style:none; }
@supports (scrollbar-width: thin) {
  .sidebar-modern__nav { scrollbar-width:thin; scrollbar-color:var(--sb-scroll-thumb) var(--sb-scroll-track); }
}
.sidebar-modern__nav::-webkit-scrollbar { width:6px; }
.sidebar-modern__nav:hover::-webkit-scrollbar { width:8px; }
.sidebar-modern__nav::-webkit-scrollbar-track { background:var(--sb-scroll-track); }
.sidebar-modern__nav::-webkit-scrollbar-thumb { background:var(--sb-scroll-thumb); border-radius:30px; }
.sidebar-modern__nav::-webkit-scrollbar-thumb:hover { background: color-mix(in srgb, var(--sb-scroll-thumb) 85%, #ffffff); }
.sidebar-modern__nav::-webkit-scrollbar-thumb:active { background: color-mix(in srgb, var(--sb-scroll-thumb) 70%, #ffffff); }

.nav-section-label { font:600 .6rem/1 var(--font-sans); letter-spacing:.7px; text-transform:uppercase; color:var(--sb-text-muted); opacity:.75; padding:.85rem .5rem .4rem; }

.nav-item { margin:.15rem 0; }
.nav-link { --active:0; position:relative; display:flex; align-items:center; gap:.75rem; padding:.62rem .7rem; border-radius:var(--sb-radius-sm); color:var(--sb-text-muted); text-decoration:none; font:600 .72rem/1.2 var(--font-sans); letter-spacing:.3px; border:1px solid transparent; background:transparent; transition:background .25s, color .25s, border-color .25s, transform .20s ease, box-shadow .25s; will-change: transform; }
.nav-link:hover { background:rgba(255,255,255,.06); color:var(--sb-text); transform:translateY(-1px); }
.nav-link[data-active='true'] { --active:1; background:var(--sidebar-active-gradient); color:#fff; box-shadow:0 8px 22px -10px rgba(0,0,0,.6); }
.nav-link::before { content:""; position:absolute; inset-inline:8px; bottom:6px; height:2px; border-radius:2px; background: linear-gradient(90deg, transparent, rgba(255,255,255,.22), transparent); opacity:0; transform:scaleX(.4); transform-origin:center; transition:opacity .25s, transform .25s; pointer-events:none; }
.nav-link[data-active='true']::before { opacity:1; transform:scaleX(1); }

/* Keyboard focus */
.nav-link:focus-visible { outline:none; color:var(--sb-text); box-shadow: 0 0 0 3px var(--sb-focus-ring), inset 0 0 0 1px rgba(255,255,255,.06); background: rgba(255,255,255,.06); }

.nav-icon { width:34px; height:34px; flex:0 0 34px; display:flex; align-items:center; justify-content:center; background:rgba(255,255,255,.07); color:var(--sb-text); border-radius:10px; font-size:1.05rem; transition:background .25s, transform .2s; box-shadow: inset 0 0 0 1px rgba(255,255,255,.07); }
.nav-link:hover .nav-icon { background:rgba(255,255,255,.14); }
.nav-link[data-active='true'] .nav-icon { background:rgba(255,255,255,.15); }

.nav-label { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* Collapsed state */
.sidebar-modern[data-collapsed='true'] .nav-label, .sidebar-modern[data-collapsed='true'] .nav-section-label { opacity:0; visibility:hidden; pointer-events:none; }
.sidebar-modern[data-collapsed='true'] .nav-link { justify-content:center; padding:.6rem .55rem; }
.sidebar-modern[data-collapsed='true'] .nav-icon { width:42px; height:42px; }

/* Tooltip (basic) */
.nav-link[data-tip]:hover::after { content:attr(data-tip); position:absolute; top:50%; transform:translateY(-50%); background:#111927; color:#fff; font:600 .6rem/1 var(--font-sans); padding:.45rem .55rem; border-radius:8px; white-space:nowrap; box-shadow:0 8px 18px -8px rgba(0,0,0,.5); z-index:1400; }
.sidebar-modern[data-collapsed='false'] .nav-link::after { display:none; }
/* RTL-aware placement: if document direction is RTL, place tooltip to the left; otherwise to the right */
:root[dir='rtl'] .nav-link[data-tip]:hover::after { right: 100%; margin-right: 8px; left: auto; transform: translateY(-50%); }
.nav-link[data-tip]:hover::after { left: 100%; margin-left: 8px; right: auto; }

/* Footer */
.sidebar-modern__footer { padding:.65rem .85rem .85rem; display:flex; flex-direction:column; gap:.55rem; border-top:1px solid var(--sb-border); margin-top:auto; }
.sidebar-mini-badge { font:600 .55rem/1 var(--font-sans); background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.08); color:var(--sb-text-muted); padding:.4rem .55rem; border-radius:8px; letter-spacing:.5px; }

/* Mobile overlay */
@media (max-width: 980px) {
  .sidebar-modern { position:fixed; inset:0 auto 0 0; transform:translateX(-110%); width:min(84vw,var(--sb-width)); max-width:330px; border-inline-end:0; border-right:1px solid var(--sb-border); }
  .sidebar-modern[data-open='true'] { transform:translateX(0); transition:transform .5s cubic-bezier(.55,.1,.3,1); }
  .sidebar-modern[data-collapsed='true'] { width:min(84vw,var(--sb-width)); }
  .sidebar-modern__backdrop {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.45);
    -webkit-backdrop-filter: blur(10px); /* دعم Safari */
    backdrop-filter:blur(2px);
    z-index:1200; /* below sidebar (1301) */
    opacity:0;
    visibility:hidden;
    pointer-events:none;
    transform:translateZ(0); /* promote layer */
    transition:opacity .35s, visibility .35s;
  }
  .sidebar-modern__backdrop[data-open='true'] {
    opacity:1;
    visibility:visible;
    pointer-events:auto;
  }
  @media (prefers-reduced-motion: reduce) {
    .sidebar-modern__backdrop { transition:none; }
  }
}

/* Reduced motion: tone down transforms for accessibility */
@media (prefers-reduced-motion: reduce) {
  .nav-link { transition: background .2s, color .2s, border-color .2s, box-shadow .2s; }
  .nav-link:hover { transform:none; }
  .sidebar-modern__toggle, .sidebar-modern[data-collapsed='true'] .sidebar-modern__toggle,
  .sidebar-modern[data-open='true'] .sidebar-modern__toggle { transition: background .2s, box-shadow .2s; transform:none; }
}

/* Light theme override */
.light .sidebar-modern { background:linear-gradient(135deg,#ffffff,#f5f7fa); color:#1f2933; border-inline-end:1px solid #dfe5ea; }
.light .nav-link { color:#4c5968; }
.light .nav-link:hover { background:#f0f3f6; color:#111d29; }
.light .nav-link[data-active='true'] { color:#fff; }
.light .nav-icon { background:#eef2f5; color:#1f2933; }
.light .nav-link:hover .nav-icon { background:#e5eaee; }
/* Light theme scrollbar tuning */
.light .sidebar-modern { --sb-scroll-thumb: rgba(var(--color-primary-rgb, 34,197,94), .22); --sb-scroll-track: transparent; }
