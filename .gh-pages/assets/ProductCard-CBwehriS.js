import{b as E,u as z,r as n,m as F,j as a,L as R}from"./vendor.react-BIXKTxlu.js";import{u as O,d as L,r as P}from"./index-B9WgXUd4.js";import{L as D}from"./LazyImage-Dc5lMgrN.js";const Q=({product:e,onClose:o})=>{const{locale:r,t:c}=O(),{addToCart:i,cartItems:x,maxPerItem:h}=L()||{addToCart:()=>{},cartItems:[],maxPerItem:10},f=E(),v=z(),[m,j]=n.useState("idle"),y=x?.find(s=>s.id===e?.id)?.quantity||0,g=y>=(h||10);n.useEffect(()=>{g&&j("max")},[g]),n.useEffect(()=>{const s=t=>{t.key==="Escape"&&o()};return window.addEventListener("keydown",s),()=>window.removeEventListener("keydown",s)},[o]);const l=Array.isArray(e?.variants)?e.variants:[],w=n.useMemo(()=>Array.isArray(e?.options)&&e.options.length?e.options:l&&l.length?Object.keys(l[0].attributes||{}).map(t=>({name:t,values:Array.from(new Set(l.map(d=>d.attributes?.[t]??"")))})):[],[e?.options,l]),[S,M]=n.useState(()=>{if(l&&l.length&&l[0].attributes)return{...l[0].attributes};const s={};return(e?.options||[]).forEach(t=>{s[t.name]=t.values?.[0]??""}),s}),u=n.useMemo(()=>!l||!l.length?null:l.find(s=>{const t=s.attributes||{};return Object.keys(S).every(d=>String(t[d]??"")===String(S[d]??""))})||l[0],[l,S]),I=u?.price??e?.price,C=u?.oldPrice??e?.oldPrice,k=(u?.stock??e?.stock)!==void 0&&(u?.stock??e?.stock)<=0,[p,V]=n.useState(1);if(!e)return null;const q=P(e?.name??e?.title,r)||(typeof e?.name=="string"?e.name:e?.title)||"",N=e?.oldPrice&&e?.oldPrice>e?.price,b=N?Math.round((1-e?.price/e?.oldPrice)*100):null;return F.createPortal(a.jsx("div",{className:"quick-view-overlay",role:"dialog","aria-modal":"true",children:a.jsxs("div",{className:"quick-view-window",children:[a.jsx("button",{className:"qv-close",onClick:o,"aria-label":c("close"),children:"×"}),a.jsxs("div",{className:"qv-body",children:[a.jsxs("div",{className:"qv-media",style:{position:"relative"},children:[a.jsx(D,{src:e.image,alt:q,sizes:"(max-width: 768px) 90vw, 420px"}),N&&a.jsxs("span",{style:{position:"absolute",top:10,right:10,background:"#69be3c",color:"#fff",padding:"6px 10px",borderRadius:10,fontSize:12,fontWeight:600},children:["-",b,"%"]}),k&&a.jsx("span",{style:{position:"absolute",top:10,left:10,background:"rgba(0,0,0,.7)",color:"#fff",padding:"6px 10px",borderRadius:10,fontSize:12},children:r==="ar"?"غير متوفر":"Out of stock"})]}),a.jsxs("div",{className:"qv-info",children:[a.jsx("h2",{children:q}),a.jsx("p",{children:P(e?.short??e?.shortDescription??e?.description,r)}),w&&w.length>0&&a.jsx("div",{className:"qv-options",style:{marginTop:8},children:w.map(s=>a.jsxs("div",{style:{marginBottom:8},children:[a.jsx("div",{style:{fontSize:12,opacity:.8,marginBottom:6},children:P(s.name,r)||s.name}),a.jsx("div",{className:"flex gap-2 flex-wrap",children:(s.values||[]).map(t=>{const d=P(t,r)||String(t),T=String(S[s.name])===String(t);return a.jsx("button",{className:`px-3 py-1 rounded-full ${T?"bg-emerald-600 text-white":"bg-slate-100 dark:bg-slate-800"}`,onClick:()=>M(A=>({...A,[s.name]:t})),children:d},t)})})]},s.name))}),a.jsxs("div",{className:"qv-price",style:{display:"flex",alignItems:"center",gap:10},children:[a.jsxs("span",{className:"new",style:{fontWeight:700,fontSize:18,color:"#69be3c"},children:[Number(I||0).toFixed(2)," ",r==="ar"?"ر.س":"SAR"]}),C&&a.jsx("span",{className:"old",style:{textDecoration:"line-through",color:"#64748b"},children:Number(C).toFixed(2)}),N&&b&&a.jsxs("span",{style:{background:"#fde68a",color:"#92400e",padding:"4px 8px",borderRadius:8,fontSize:12},children:["-",b,"%"]})]}),a.jsxs("div",{style:{fontSize:12,color:"#475569",marginTop:6},children:[u?.sku&&a.jsxs("span",{style:{marginRight:10},children:["SKU: ",u.sku]}),a.jsxs("span",{children:[k?r==="ar"?"غير متوفر":"Out of stock":r==="ar"?"متوفر":"In stock",(u?.stock??e.stock)!=null?` · ${u?.stock??e.stock}`:""]})]}),a.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",alignItems:"center",marginTop:12},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[a.jsx("button",{className:"qv-qty-btn",onClick:()=>V(s=>Math.max(1,s-1)),disabled:p<=1,children:"-"}),a.jsx("div",{style:{minWidth:36,textAlign:"center"},children:p}),a.jsx("button",{className:"qv-qty-btn",onClick:()=>V(s=>Math.min(s+1,(u?.stock??e.stock)||h||99)),disabled:p>=(u?.stock??e.stock)||p>=(h||99),children:"+"})]}),a.jsx("button",{className:`add-btn ${m==="added"?"added":""} ${m==="max"?"at-max":""}`,disabled:k||g,style:k||g?{opacity:.6,cursor:"not-allowed"}:null,onClick:()=>{if(k||g)return;const s=u?{...e,variantId:u.id}:e,t=i(s,p);if(t?.ok){const d=y+p>=(h||10);j(d?"max":"added"),setTimeout(()=>j(d?"max":"idle"),1300)}else if(t?.reason==="AUTH_REQUIRED"){const d=v.pathname+(v.search||"");f("/login",{state:{from:d}})}},children:k?r==="ar"?"غير متوفر":"Out of stock":g?r==="ar"?"الحد الأقصى":"Max":m==="added"?r==="ar"?"✓ تمت الإضافة":"✓ Added":c&&c("addToCart")}),y>0&&a.jsxs("span",{style:{fontSize:12,color:"#475569"},children:["(",r==="ar"?"في السلة":"In cart",": ",y,")"]}),a.jsx("button",{onClick:o,className:"btn-secondary",style:{fontSize:12},children:r==="ar"?"إغلاق":"Close"})]})]})]})]})}),document.body)},U=n.memo(({product:e,hasDiscount:o,discountPercent:r,outOfStock:c,showImageBadge:i,locale:x})=>a.jsxs(a.Fragment,{children:[e.badge&&a.jsx("span",{className:"badge",children:x==="ar"?"جديد":"New"}),i&&o&&a.jsxs("span",{className:"discount-badge",children:["-",r,"%"]}),c&&a.jsx("span",{className:"gallery-indicator",style:{background:"rgba(109,1,11,.85)"},children:x==="ar"?"غير متوفر":"Out"})]})),W=n.memo(({rating:e})=>e?a.jsx("div",{className:"rating-row","aria-label":`rating ${e}`,children:[1,2,3,4,5].map(o=>a.jsx("span",{className:`star ${o<=e?"":"off"}`,children:"★"},o))}):null),H=n.memo(({price:e,baseOld:o,hasDiscount:r,discountPercent:c,savings:i,showPriceBadge:x,locale:h})=>a.jsxs("div",{className:"price-row",children:[a.jsxs("span",{className:"price",children:[e," ",h==="ar"?"ر.س":"SAR"]}),Number.isFinite(o)&&a.jsx("span",{className:"old",children:o}),x&&r&&typeof c=="number"&&a.jsxs("span",{className:"badge-soft",style:{fontSize:".62rem",padding:".15rem .4rem",borderRadius:8,marginInlineStart:6},children:["-",c,"%"]}),r&&i>0&&a.jsx("span",{className:"save-badge","aria-label":h==="ar"?`وفرت ${i} ر.س`:`Saved ${i} SAR`,children:h==="ar"?`وفّرت ${i} ر.س`:`Saved ${i} SAR`})]})),K=n.memo(({product:e,currentQty:o,maxPerItem:r,outOfStock:c,locale:i,t:x,onAddToCart:h})=>{const[f,v]=n.useState("idle"),m=o>=(r||10);n.useEffect(()=>{m?v("max"):f==="max"&&v("idle")},[m,f]);const j=n.useCallback(()=>{if(c||m)return;const g=h(e,1);if(g?.ok){const l=o+1>=(r||10);v(l?"max":"added");const w=setTimeout(()=>{v(l?"max":"idle")},1400);return()=>clearTimeout(w)}return g},[e,o,r,c,m,h]),$=n.useCallback(()=>c?i==="ar"?"غير متوفر":"Out of stock":m?i==="ar"?"الحد الأقصى":"Max":f==="added"?i==="ar"?"✓ تمت الإضافة":"✓ Added":x("addToCart"),[c,m,f,i,x]),y=n.useCallback(()=>c?i==="ar"?"غير متوفر":"Out of stock":m?i==="ar"?"الحد الأقصى":"Max reached":x("addToCart"),[c,m,i,x]);return a.jsx("button",{className:`primary ${f==="added"?"added":""} ${f==="max"?"at-max":""}`,disabled:c||m,onClick:j,"aria-label":y(),children:$()})}),_=({product:e,showImageBadge:o=!0,showPriceBadge:r=!0,priority:c=!1})=>{const{locale:i,t:x}=O(),{addToCart:h,cartItems:f,maxPerItem:v}=L()||{addToCart:()=>({}),cartItems:[],maxPerItem:10},m=E(),j=z(),[$,y]=n.useState(!1),g=n.useMemo(()=>P(e?.name??e?.title,i)||(typeof e?.name=="string"?e.name:e?.title)||"",[e,i]),l=n.useMemo(()=>`${i==="ar"?"":"/"+i}/product/${e.id}`,[i,e.id]),{baseOld:w,priceNum:S,hasDiscount:M,discountPercent:u,savings:I,outOfStock:C}=n.useMemo(()=>{const b=e?.oldPrice??e?.originalPrice,s=b!=null?+b:void 0,t=e?.price!=null?+e.price:void 0,d=Number.isFinite(s)&&Number.isFinite(t)&&s>t,T=d?Math.round((1-t/s)*100):null,A=d?Math.max(0,s-t):0,B=e.stock!==void 0&&e.stock<=0;return{baseOld:s,priceNum:t,hasDiscount:d,discountPercent:T,savings:A,outOfStock:B}},[e]),p=n.useMemo(()=>f?.find(b=>b.id===e.id),[f,e.id])?.quantity||0,V=n.useCallback((b,s)=>{const t=h(b,s);if(t?.reason==="AUTH_REQUIRED"){const d=j.pathname+(j.search||"");m("/login",{state:{from:d}})}return t},[h,m,j]),q=n.useCallback(b=>{b.preventDefault(),b.stopPropagation(),y(!0)},[]),N=n.useMemo(()=>({avifSrcSet:e.imageVariants?.avif?[e.imageVariants.avif.thumb&&`${e.imageVariants.avif.thumb} 200w`,e.imageVariants.avif.medium&&`${e.imageVariants.avif.medium} 400w`,e.imageVariants.avif.large&&`${e.imageVariants.avif.large} 800w`].filter(Boolean).join(", "):void 0,webpSrcSet:e.imageVariants?.webp?[e.imageVariants.webp.thumb&&`${e.imageVariants.webp.thumb} 200w`,e.imageVariants.webp.medium&&`${e.imageVariants.webp.medium} 400w`,e.imageVariants.webp.large&&`${e.imageVariants.webp.large} 800w`].filter(Boolean).join(", "):void 0}),[e.imageVariants]);return a.jsxs("div",{className:"product-card","data-id":e.id,children:[a.jsxs(R,{to:l,className:"product-image product-media","aria-label":g,children:[a.jsx(D,{src:e.imageVariants?.thumb||e.image,alt:g,className:"w-full h-full object-cover",sizes:"(max-width: 640px) 50vw, (max-width: 1024px) 25vw, 240px",avifSrcSet:N.avifSrcSet,webpSrcSet:N.webpSrcSet,width:400,height:400,priority:c}),a.jsx(U,{product:e,hasDiscount:M,discountPercent:u,outOfStock:C,showImageBadge:o,locale:i}),a.jsx("div",{className:"product-overlay",children:a.jsx("button",{className:"quick-view-btn",onClick:q,children:x("quickView")})})]}),a.jsx("h3",{className:"product-title clamp-2",children:g}),a.jsx(W,{rating:e.rating}),a.jsx(H,{price:e.price,baseOld:w,hasDiscount:M,discountPercent:u,savings:I,showPriceBadge:r,locale:i}),a.jsxs("div",{className:"actions",children:[a.jsx(K,{product:e,currentQty:p,maxPerItem:v,outOfStock:C,locale:i,t:x,onAddToCart:V}),a.jsx(R,{to:l,children:x("details")})]}),$&&a.jsx(Q,{product:e,onClose:()=>y(!1)})]})},Y=n.memo(_),Z=()=>a.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden animate-pulse",children:[a.jsx("div",{className:"aspect-square bg-gray-300"}),a.jsxs("div",{className:"p-4 space-y-3",children:[a.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),a.jsx("div",{className:"h-6 bg-gray-300 rounded w-full"}),a.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"}),a.jsx("div",{className:"h-10 bg-gray-300 rounded"})]})]});export{Z as P,Y as a};
