import{j as e,a1 as T,a6 as E,R as I,L as G,u as J,r as c}from"./vendor.react-BIXKTxlu.js";import{u as z,a as B,S as H}from"./index-B9WgXUd4.js";import{P as Q,a as K}from"./ProductGridSkeleton-CFLjTsey.js";import{u as V,a as W,b as X}from"./products-CwuqQWxp.js";import"./vendor-CKneRQof.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-Dl6I9sMh.js";/* empty css                     */import"./ProductCard-CBwehriS.js";import"./LazyImage-Dc5lMgrN.js";const Y=({state:i,onChange:l,sidebar:x=!1})=>{const{locale:N}=z(),a=N==="ar",o=t=>l({...i,...t}),b=()=>l({...i,sort:"new",min:"",max:"",rating:"",discount:!1}),u=!!(i.min||i.max||i.rating||i.discount),v=x?"grid grid-cols-1 gap-2 md:gap-2.5 sticky top-30":"w-full";return e.jsxs("div",{className:"product-filters "+v,children:[x&&e.jsxs("div",{className:"flex items-center justify-between mb-0.5",children:[e.jsxs("div",{className:"text-xs text-slate-500",children:[a?"تصفية النتائج":"Filter results",u?e.jsx("span",{className:"ms-1 inline-block rounded-full bg-slate-100 px-1.5 py-0.5 text-[10px] text-slate-600",children:a?"مفعّل":"Active"}):null]}),e.jsxs("button",{type:"button",onClick:b,className:"inline-flex items-center gap-1 text-[11px] text-sky-700 hover:text-sky-800",children:[e.jsx(T,{className:"size-3"})," ",a?"إعادة ضبط":"Reset"]})]}),!x&&e.jsxs("div",{role:"toolbar","aria-label":a?"شريط تصفية المنتجات":"Products filter toolbar",className:"flex flex-wrap items-center gap-2 rounded-xl border border-slate-200 bg-white/80 p-2 shadow-sm backdrop-blur supports-[backdrop-filter]:bg-white/70",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"sort",className:"sr-only",children:a?"الترتيب":"Sort"}),e.jsxs("select",{id:"sort",value:i.sort,onChange:t=>o({sort:t.target.value}),className:"h-8 min-w-[8rem] rounded-md border border-slate-200 bg-white px-2 text-xs",children:[e.jsx("option",{value:"new",children:a?"الأحدث":"Newest"}),e.jsx("option",{value:"price-asc",children:a?"السعر ↑":"Price ↑"}),e.jsx("option",{value:"price-desc",children:a?"السعر ↓":"Price ↓"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-[11px] text-slate-600",children:a?"السعر":"Price"}),e.jsx("input",{type:"number",min:"0",value:i.min||"",onChange:t=>o({min:t.target.value}),placeholder:a?"من":"Min",className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"}),e.jsx("span",{className:"text-[11px] text-slate-500",children:a?"إلى":"to"}),e.jsx("input",{type:"number",min:"0",value:i.max||"",onChange:t=>o({max:t.target.value}),placeholder:a?"أقصى":"Max",className:"h-8 w-24 rounded-md border border-slate-200 bg-white px-2 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("label",{htmlFor:"rating",className:"sr-only",children:a?"التقييم":"Rating"}),e.jsxs("select",{id:"rating",value:i.rating||"",onChange:t=>o({rating:t.target.value}),className:"h-8 min-w-[7rem] rounded-md border border-slate-200 bg-white px-2 text-xs",children:[e.jsx("option",{value:"",children:a?"الكل":"All"}),[5,4,3,2,1].map(t=>e.jsx("option",{value:t,children:a?`على الأقل ${t}`:`≥ ${t}`},t))]})]}),e.jsxs("label",{className:"ms-auto inline-flex items-center gap-2 rounded-md bg-slate-50 px-2 py-1 text-xs text-slate-800",children:[e.jsx("span",{children:a?"خصم":"Discount"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"discount",type:"checkbox",checked:!!i.discount,onChange:t=>o({discount:t.target.checked}),className:"peer sr-only"}),e.jsx("span",{className:"block h-4 w-8 rounded-full bg-slate-300 peer-checked:bg-sky-600 transition-colors",children:e.jsx("span",{className:"block h-3.5 w-3.5 translate-x-0.5 translate-y-0.5 rounded-full bg-white shadow transition-transform peer-checked:translate-x-[14px]"})})]})]}),e.jsxs("button",{type:"button",onClick:b,className:"inline-flex items-center gap-1.5 rounded-md border border-slate-200 bg-slate-50 px-2.5 py-1.5 text-xs text-slate-700 hover:bg-slate-100",children:[e.jsx(T,{className:"size-3.5"})," ",a?"إعادة ضبط":"Reset"]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:a?"الترتيب":"Sort"}),e.jsx(E,{className:"size-1.5 transition-transform group-open:rotate-180"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{id:"sort",value:i.sort,onChange:t=>o({sort:t.target.value}),className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs",children:[e.jsx("option",{value:"new",children:a?"الأحدث":"Newest"}),e.jsx("option",{value:"price-asc",children:a?"السعر ↑":"Price ↑"}),e.jsx("option",{value:"price-desc",children:a?"السعر ↓":"Price ↓"})]})})]}),e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",open:!0,children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:a?"السعر":"Price"}),e.jsx(E,{className:"size-3.5 transition-transform group-open:rotate-180"})]}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-1.5",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[11px] text-slate-500",children:a?"من":"Min"}),e.jsx("input",{type:"number",min:"0",value:i.min||"",onChange:t=>o({min:t.target.value}),placeholder:a?"أدنى":"Min",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("label",{className:"text-[11px] text-slate-500",children:a?"إلى":"Max"}),e.jsx("input",{type:"number",min:"0",value:i.max||"",onChange:t=>o({max:t.target.value}),placeholder:a?"أقصى":"Max",className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs outline-none focus:ring-2 focus:ring-sky-500",inputMode:"numeric"})]})]})]}),e.jsxs("details",{className:"group rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm open:shadow",children:[e.jsxs("summary",{className:"flex cursor-pointer list-none items-center justify-between text-xs font-medium text-slate-800",children:[e.jsx("span",{children:a?"التقييم":"Rating"}),e.jsx(E,{className:"size-3.5 transition-transform group-open:rotate-180"})]}),e.jsx("div",{className:"mt-2",children:e.jsxs("select",{value:i.rating||"",onChange:t=>o({rating:t.target.value}),className:"w-full rounded-md border border-slate-200 bg-white px-2 py-1.5 text-xs",children:[e.jsx("option",{value:"",children:a?"الكل":"All"}),[5,4,3,2,1].map(t=>e.jsx("option",{value:t,children:a?`على الأقل ${t}`:`≥ ${t}`},t))]})})]}),e.jsx("div",{className:"rounded-lg border border-slate-200 bg-white p-2.5 shadow-sm",children:e.jsxs("label",{className:"flex items-center justify-between gap-2 text-xs text-slate-800",children:[e.jsx("span",{children:a?"خصم":"Discount"}),e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{id:"discount",type:"checkbox",checked:!!i.discount,onChange:t=>o({discount:t.target.checked}),className:"peer sr-only"}),e.jsx("span",{className:"block h-4 w-8 rounded-full bg-slate-300 peer-checked:bg-sky-600 transition-colors",children:e.jsx("span",{className:"block h-3.5 w-3.5 translate-x-0.5 translate-y-0.5 rounded-full bg-white shadow transition-transform peer-checked:translate-x-[14px]"})})]})]})})]})]})},Z=({items:i=[],className:l=""})=>!Array.isArray(i)||!i.length?null:e.jsx("nav",{className:`text-sm text-gray-500 mb-3 ${l}`,"aria-label":"breadcrumb",children:e.jsx("ol",{className:"flex items-center gap-2",children:i.map((x,N)=>e.jsxs(I.Fragment,{children:[N>0&&e.jsx("li",{"aria-hidden":!0,children:"›"}),e.jsx("li",{children:x.to?e.jsx(G,{to:x.to,className:"hover:text-primary-red",children:x.label}):e.jsx("span",{className:"text-gray-700",children:x.label})})]},N))})}),ue=()=>{const i=J(),{locale:l}=z(),{setting:x}=B()||{},N=l==="ar"?x?.siteNameAr||"شركة منفذ اسيا التجارية":x?.siteNameEn||"My Store",a=l==="ar"?`المنتجات | ${N}`:`${N} | Products`,o=c.useMemo(()=>({q:new URLSearchParams(i.search).get("q")||void 0,category:new URLSearchParams(i.search).get("category")||void 0}),[i.search]),b=12,[u,v]=c.useState({...o,page:1,pageSize:b}),{data:t,isLoading:S,isFetching:M,error:C,refetch:R}=V(u);W();const[n,w]=c.useState({q:o.q||"",category:o.category||"",sort:"new",min:"",max:"",rating:"",discount:!1,page:1}),P=c.useRef(null);c.useEffect(()=>{v(s=>({...s,...o,page:1}))},[o.q,o.category]),c.useEffect(()=>(P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{v(s=>({...s,page:1,pageSize:b,q:n.q||void 0,category:n.category||void 0,minPrice:n.min||void 0,maxPrice:n.max||void 0}))},300),()=>{P.current&&clearTimeout(P.current)}),[n.q,n.category,n.min,n.max]),c.useEffect(()=>{Number(n.page)!==Number(u.page)&&w(s=>({...s,page:Number(u.page)||1}))},[u.page]),c.useEffect(()=>{const s=new URLSearchParams(window.location.search),r={};["category","sort","min","max","rating","discount","page"].forEach(m=>{s.has(m)&&(r[m]=s.get(m))}),r.discount!=null&&(r.discount=String(r.discount)==="true"),r.page!=null&&(r.page=+r.page||1);const d={...n,...r};JSON.stringify(d)===JSON.stringify(n)||w(d)},[i.search]),c.useEffect(()=>{const s=new URLSearchParams;Object.entries(n).forEach(([h,m])=>{m!==""&&m!==!1&&m!=null&&s.set(h,m)});const r=s.toString(),d=window.location.pathname+(r?`?${r}`:"");window.location.search!==(r?`?${r}`:"")&&window.history.replaceState({},"",d)},[n]);const[$,L]=c.useState([]);c.useEffect(()=>{const s=Array.isArray(t)?t:Array.isArray(t?.items)?t.items:[];Number(t?.page||u.page||1)<=1?L(s||[]):s&&s.length&&L(d=>{const h=new Set(d.map(f=>f.id)),m=s.filter(f=>!h.has(f.id));return d.concat(m)})},[t?.items,t,u.page]);const g=c.useMemo(()=>{let s=$.slice();return n.category&&(s=s.filter(r=>r.category===n.category)),n.min&&(s=s.filter(r=>+r.price>=+n.min)),n.max&&(s=s.filter(r=>+r.price<=+n.max)),n.rating&&(s=s.filter(r=>(r.rating||0)>=+n.rating)),n.discount&&(s=s.filter(r=>{const d=r.oldPrice??r.originalPrice,h=d!=null?+d:NaN,m=r.price!=null?+r.price:NaN;return Number.isFinite(h)&&Number.isFinite(m)&&h>m})),n.sort==="price-asc"&&s.sort((r,d)=>+r.price-+d.price),n.sort==="price-desc"&&s.sort((r,d)=>+d.price-+r.price),s},[n,$]),O=t?.total??(Array.isArray(t)?t.length:t?.items?.length||0),k=Math.max(1,Math.ceil(O/b)),j=Number(t?.page||n.page||1),y=g.slice(0,j*b);c.useEffect(()=>{n.page!==j&&w(s=>({...s,page:j}))},[j]);const U=X(u,j<k);c.useEffect(()=>{if(j<k)try{U()}catch{}},[j,k,u.q,u.category,u.minPrice,u.maxPrice]);const[D,A]=c.useState(!1),F=c.useRef(null),p=c.useRef({startY:0,pulling:!1,offset:0});return c.useEffect(()=>{const s=F.current;if(!s)return;const r=60,d=f=>{window.scrollY>0||(p.current.startY=f.touches[0].clientY,p.current.pulling=!0,p.current.offset=0)},h=f=>{if(!p.current.pulling)return;const q=f.touches[0].clientY-p.current.startY;q>0&&window.scrollY<=0&&(p.current.offset=Math.min(100,q*.6),s.style.transform=`translateY(${p.current.offset}px)`)},m=async()=>{if(!p.current.pulling)return;const f=p.current.offset>r;if(s.style.transition="transform 180ms ease",s.style.transform="translateY(0)",setTimeout(()=>{s.style.transition=""},220),p.current.pulling=!1,p.current.offset=0,f)try{await R()}catch{}};return s.addEventListener("touchstart",d,{passive:!0}),s.addEventListener("touchmove",h,{passive:!0}),s.addEventListener("touchend",m,{passive:!0}),()=>{s.removeEventListener("touchstart",d),s.removeEventListener("touchmove",h),s.removeEventListener("touchend",m)}},[R]),e.jsxs("div",{ref:F,className:"offers-page catalog-page container-custom px-4 py-8",style:{willChange:"transform",touchAction:"pan-x pan-y"},children:[e.jsx(H,{title:a,description:l==="ar"?"المنتجات":"Products"}),e.jsx(Z,{items:[{label:l==="ar"?"الرئيسية":"Home",to:"/"},{label:l==="ar"?"المنتجات":"Products"}]}),e.jsx("h1",{className:"page-title mb-4",children:l==="ar"?"المنتجات":"Products"}),e.jsx("div",{className:"md:hidden mb-3 flex justify-between items-center",children:e.jsx("div",{className:"text-xs text-gray-600",children:l==="ar"?`عرض ${Math.min(y.length,g.length)} من ${g.length}`:`Showing ${Math.min(y.length,g.length)} of ${g.length}`})}),D&&e.jsxs("div",{className:"fixed inset-0 z-50 md:hidden",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>A(!1)}),e.jsxs("div",{className:"absolute inset-y-0 start-0 w-[86vw] max-w-[360px] bg-white p-4 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-bold",children:l==="ar"?"الفلاتر":"Filters"}),e.jsx("button",{className:"text-sm",onClick:()=>A(!1),children:l==="ar"?"إغلاق":"Close"})]}),e.jsx(Y,{state:n,onChange:w,sidebar:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:e.jsxs("section",{children:[e.jsx("div",{className:"hidden md:block mb-3 md:sticky md:top-24 z-10",children:e.jsx(Y,{state:n,onChange:w})}),e.jsxs("div",{className:"flex items-center justify-between mb-3 text-sm text-gray-600",children:[e.jsx("div",{children:l==="ar"?`عرض ${Math.min(y.length,g.length)} من ${g.length}`:`Showing ${Math.min(y.length,g.length)} of ${g.length}`}),e.jsx("div",{className:"text-xs text-gray-400","aria-hidden":"true",children:M?l==="ar"?"تحديث...":"Refreshing...":l==="ar"?"اسحب للأسفل للتحديث":"Pull down to refresh"})]}),S&&e.jsx(Q,{count:b}),C&&e.jsx("p",{className:"text-red-600 text-sm",children:l==="ar"?"فشل التحميل":"Failed to load products."}),!S&&!C&&y.length===0&&e.jsx("p",{children:l==="ar"?"لا توجد نتائج":"No results"}),!S&&!C&&y.length>0&&e.jsx(K,{products:y}),j<k&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{className:"btn-primary px-4 py-2",onClick:()=>{v(s=>({...s,page:(Number(s.page)||1)+1})),w(s=>({...s,page:(Number(s.page)||1)+1}))},disabled:M,children:M?l==="ar"?"جارٍ التحميل...":"Loading...":l==="ar"?"تحميل المزيد":"Load more"})})]})})]})};export{ue as default};
