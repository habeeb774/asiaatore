import{r as i,j as e}from"./vendor.react-BIXKTxlu.js";import{v as P}from"./index-B9WgXUd4.js";import{D as E}from"./DataTable-CmXR19l9.js";import{D as R,C as D}from"./ConfirmModal-CBQLnJ0u.js";import{u as L}from"./products-CwuqQWxp.js";import"./vendor-CKneRQof.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-Dl6I9sMh.js";/* empty css                     */function U({label:d="Upload image",onChange:b,accept:j="image/*",multiple:f=!1}){const h=i.useRef(null),[N,u]=i.useState(null),[v,y]=i.useState(!1),[m,w]=i.useState(null);async function c(s,a=600,p=.85,l="image/jpeg"){const n=document.createElement("img");n.decoding="async",n.src=URL.createObjectURL(s),await n.decode();const C=Math.min(1,a/n.naturalWidth),k=Math.round(n.naturalWidth*C),S=Math.round(n.naturalHeight*C),x=document.createElement("canvas");x.width=k,x.height=S,x.getContext("2d").drawImage(n,0,0,k,S);const o=await new Promise(r=>x.toBlob(r,l,p));return URL.revokeObjectURL(n.src),o}async function g(s){if(!(!s||s.length===0)){y(!0),w(null);try{const a=s[0];u(URL.createObjectURL(a));const p={};try{p.thumb=await c(a,300,.8,"image/webp")}catch{}b&&b({original:a,variants:p})}catch(a){w(a.message||String(a))}finally{y(!1)}}}return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-outline",type:"button",onClick:()=>h.current?.click(),disabled:v,children:v?"Processing…":d}),m&&e.jsx("span",{className:"text-sm text-red-600",children:m})]}),e.jsx("input",{ref:h,type:"file",accept:j,multiple:f,onChange:s=>g(s.target.files),className:"hidden"}),N&&e.jsx("div",{className:"rounded border p-2 inline-block",children:e.jsx("img",{src:N,alt:"preview",className:"max-h-40 object-contain"})})]})}function $(){const[d,b]=i.useState(""),[j,f]=i.useState(1),[h,N]=i.useState(25),{data:u,isLoading:v,refetch:y}=L({q:d,page:j,pageSize:h}),m=u?.items||u||[],w=u?.total??m.length,[c,g]=i.useState(null),[s,a]=i.useState(null),p=i.useMemo(()=>{const t=d.trim().toLowerCase();return(m||[]).filter(o=>!t||String(o.id).includes(t)||o.name?.toLowerCase()?.includes(t))},[m,d]),[l,n]=i.useState({});function C(t,o,r){n({id:t,key:o,value:r})}function k(){n({})}const S=[{header:"ID",accessorKey:"id",width:"100px"},{header:"Name",cell:t=>t.name||t.title},{header:"Price",cell:t=>l.id===t.id&&l.key==="price"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border rounded px-2 py-1 w-24",type:"number",value:l.value,onChange:r=>n({...l,value:r.target.value})}),e.jsx("button",{className:"btn-primary btn-xs",onClick:k,children:"Save"})]}):e.jsxs("button",{className:"btn-ghost btn-xs",onClick:r=>{r.stopPropagation(),C(t.id,"price",t.price)},children:[Number(t.price||0).toFixed(2)," SAR"]})},{header:"Stock",accessorKey:"stock"},{header:"Status",cell:t=>t.active?"Active":"Hidden"},{header:"Actions",cell:t=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-outline btn-xs",onClick:o=>{o.stopPropagation(),g(t)},children:"Edit"}),e.jsx("button",{className:"btn-outline btn-xs",onClick:o=>{o.stopPropagation(),a({action:"delete",product:t})},children:"Delete"})]})}],x=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border rounded px-3 py-1 text-sm",placeholder:"بحث بالاسم/الرقم",value:d,onChange:t=>b(t.target.value)}),e.jsx("button",{className:"btn-outline",onClick:()=>y(),children:"تحديث"}),e.jsx("button",{className:"btn-primary",onClick:()=>a({action:"bulkEdit"}),children:"Bulk editor"}),e.jsx("button",{className:"btn-outline",onClick:()=>a({action:"create"}),children:"New product"})]});return e.jsxs(P,{title:"المنتجات",topbar:x,children:[v?e.jsx("div",{className:"skeleton h-24"}):e.jsx(E,{columns:S,data:p,serverMode:!!u?.total,page:j,pageSize:h,total:w,onPageChange:f,onPageSizeChange:t=>{N(t),f(1)},onRowClick:t=>g(t)}),e.jsx(R,{open:!!c,onClose:()=>g(null),title:c?`Product #${c.id}`:"",children:c&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsx("div",{className:"font-semibold",children:"Images"}),e.jsx(U,{onChange:t=>console.log("upload",t)}),e.jsx("div",{className:"font-semibold",children:"Fields"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"text-xs",children:["Name",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:c.name})]}),e.jsxs("label",{className:"text-xs",children:["Price",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:c.price,type:"number"})]}),e.jsxs("label",{className:"text-xs",children:["Stock",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:c.stock,type:"number"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"btn-primary",children:"Save changes"})})]})}),e.jsx(D,{open:!!s,onClose:()=>a(null),title:s?.action==="delete"?"Delete product":"Bulk editor",danger:s?.action==="delete",message:s?.action==="delete"?`Delete ${s.product?.name||s.product?.id}?`:"Open bulk editor (coming soon)",confirmText:s?.action==="delete"?"Delete":"OK",onConfirm:()=>a(null)})]})}export{$ as default};
