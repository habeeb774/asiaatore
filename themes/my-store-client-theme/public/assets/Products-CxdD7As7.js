import{r as d,j as e,R as E}from"./vendor.react-BYd2qOD7.js";import{n as k,w as M,x as R}from"./index-KQCI4LeS.js";import{M as L}from"./Modal-B0gOZ9wp.js";import{u as D}from"./products-Dr55B0VG.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */function A({columns:l=[],data:a=[],serverMode:n=!1,page:r=1,pageSize:o=25,total:u=0,onPageChange:i,onPageSizeChange:c,onRowClick:p}){const f=d.useMemo(()=>{const t=u||a.length||0;return Math.max(1,Math.ceil(t/Math.max(1,o)))},[u,a.length,o]),y=d.useMemo(()=>{if(n)return a;const t=(Math.max(1,r)-1)*Math.max(1,o);return a.slice(t,t+o)},[a,r,o,n]);function m(){const t=Math.max(1,r-1);t!==r&&i&&i(t)}function g(){const t=Math.min(f,r+1);t!==r&&i&&i(t)}function x(t){const j=Number(t.target.value)||25;c?.(j)}return e.jsxs("div",{className:"w-full overflow-x-auto",children:[e.jsxs("table",{className:"w-full text-sm",style:{borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-800/50",children:l.map((t,j)=>e.jsx("th",{className:"text-left font-semibold px-3 py-2 border-b border-gray-200 dark:border-gray-700",style:t.width?{width:t.width}:void 0,children:t.header},j))})}),e.jsx("tbody",{children:y.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-6 text-center text-gray-500",colSpan:l.length,children:"No data"})}):y.map((t,j)=>e.jsx("tr",{className:"hover:bg-gray-50/80 dark:hover:bg-gray-800/40 cursor-pointer",onClick:()=>p?.(t),children:l.map((h,N)=>e.jsx("td",{className:"px-3 py-2 border-b border-gray-100 dark:border-gray-800",children:h.cell?h.cell(t):h.accessorKey?t[h.accessorKey]:""},N))},t.id??j))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3 mt-3",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Page ",r," of ",f]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"text-xs text-gray-600 dark:text-gray-300",children:["Page size",e.jsx("select",{className:"ml-2 border rounded px-2 py-1 text-xs bg-white dark:bg-gray-900",value:o,onChange:x,children:[10,25,50,100].map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-outline btn-xs",onClick:m,disabled:r<=1,children:"Prev"}),e.jsx("button",{className:"btn-outline btn-xs",onClick:g,disabled:r>=f,children:"Next"})]})]})]})]})}function K({open:l,onClose:a,title:n,message:r,confirmText:o="Confirm",cancelText:u="Cancel",danger:i=!1,onConfirm:c}){const p=e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(k,{variant:"ghost",onClick:a,children:u}),e.jsx(k,{variant:i?"danger":"primary",onClick:()=>{c?.(),a?.()},children:o})]});return e.jsx(L,{open:l,onClose:a,title:n,footer:p,children:e.jsx("div",{className:"text-sm text-foreground/80 whitespace-pre-line",children:r})})}function U({open:l,onClose:a,title:n,children:r,width:o=420,className:u}){if(d.useEffect(()=>{const c=p=>{p.key==="Escape"&&l&&a?.()};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[l,a]),!l)return null;const i=c=>{c.target===c.currentTarget&&a?.()};return e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:i}),e.jsxs("div",{className:M("absolute top-0 right-0 h-full bg-white dark:bg-[#0f1525] border-l border-black/10 dark:border-white/10 shadow-xl flex flex-col",u),style:{width:o},role:"dialog","aria-modal":"true",children:[(n||a)&&e.jsxs("div",{className:"px-4 py-3 border-b border-black/5 dark:border-white/10 flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold truncate",children:n}),a&&e.jsx(k,{variant:"ghost",size:"sm",onClick:a,"aria-label":"Close",children:"✕"})]}),e.jsx("div",{className:"p-4 overflow-auto flex-1",children:r})]})]})}function B({onChange:l}){const a=d.useRef(null),[n,r]=d.useState([]);function o(){a.current?.click()}function u(i){const c=Array.from(i.target.files||[]);r(c),l?.({files:c})}return e.jsxs("div",{className:"border rounded-lg p-3",children:[e.jsx("input",{ref:a,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:u}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-300",children:n.length?`${n.length} file(s) selected`:"No files selected"}),e.jsx(k,{variant:"outline",size:"sm",onClick:o,children:"Choose files"})]}),n.length>0&&e.jsx("div",{className:"grid grid-cols-4 gap-2 mt-3",children:n.map((i,c)=>e.jsx(F,{file:i},c))})]})}function F({file:l}){const[a,n]=d.useState("");return E.useEffect(()=>{const r=URL.createObjectURL(l);return n(r),()=>URL.revokeObjectURL(r)},[l]),e.jsx("div",{className:"w-full aspect-square bg-gray-100 dark:bg-gray-800 rounded overflow-hidden",children:a&&e.jsx("img",{src:a,alt:l.name,className:"w-full h-full object-cover"})})}function W(){const[l,a]=d.useState(""),[n,r]=d.useState(1),[o,u]=d.useState(25),{data:i,isLoading:c,refetch:p}=D({q:l,page:n,pageSize:o}),f=i?.items||i||[],y=i?.total??f.length,[m,g]=d.useState(null),[x,t]=d.useState(null),j=d.useMemo(()=>{const s=l.trim().toLowerCase();return(f||[]).filter(b=>!s||String(b.id).includes(s)||b.name?.toLowerCase()?.includes(s))},[f,l]),[h,N]=d.useState({});function w(s,b,v){N({id:s,key:b,value:v})}function C(){N({})}const P=[{header:"ID",accessorKey:"id",width:"100px"},{header:"Name",cell:s=>s.name||s.title},{header:"Price",cell:s=>h.id===s.id&&h.key==="price"?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border rounded px-2 py-1 w-24",type:"number",value:h.value,onChange:v=>N({...h,value:v.target.value})}),e.jsx("button",{className:"btn-primary btn-xs",onClick:C,children:"Save"})]}):e.jsxs("button",{className:"btn-ghost btn-xs",onClick:v=>{v.stopPropagation(),w(s.id,"price",s.price)},children:[Number(s.price||0).toFixed(2)," SAR"]})},{header:"Stock",accessorKey:"stock"},{header:"Status",cell:s=>s.active?"Active":"Hidden"},{header:"Actions",cell:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"btn-outline btn-xs",onClick:b=>{b.stopPropagation(),g(s)},children:"Edit"}),e.jsx("button",{className:"btn-outline btn-xs",onClick:b=>{b.stopPropagation(),t({action:"delete",product:s})},children:"Delete"})]})}],S=e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{className:"border rounded px-3 py-1 text-sm",placeholder:"بحث بالاسم/الرقم",value:l,onChange:s=>a(s.target.value)}),e.jsx("button",{className:"btn-outline",onClick:()=>p(),children:"تحديث"}),e.jsx("button",{className:"btn-primary",onClick:()=>t({action:"bulkEdit"}),children:"Bulk editor"}),e.jsx("button",{className:"btn-outline",onClick:()=>t({action:"create"}),children:"New product"})]});return e.jsxs(R,{title:"المنتجات",topbar:S,children:[c?e.jsx("div",{className:"skeleton h-24"}):e.jsx(A,{columns:P,data:j,serverMode:!!i?.total,page:n,pageSize:o,total:y,onPageChange:r,onPageSizeChange:s=>{u(s),r(1)},onRowClick:s=>g(s)}),e.jsx(U,{open:!!m,onClose:()=>g(null),title:m?`Product #${m.id}`:"",children:m&&e.jsxs("div",{className:"space-y-4 text-sm",children:[e.jsx("div",{className:"font-semibold",children:"Images"}),e.jsx(B,{onChange:s=>console.log("upload",s)}),e.jsx("div",{className:"font-semibold",children:"Fields"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("label",{className:"text-xs",children:["Name",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:m.name})]}),e.jsxs("label",{className:"text-xs",children:["Price",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:m.price,type:"number"})]}),e.jsxs("label",{className:"text-xs",children:["Stock",e.jsx("input",{className:"mt-1 border rounded px-2 py-1 w-full",defaultValue:m.stock,type:"number"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsx("button",{className:"btn-primary",children:"Save changes"})})]})}),e.jsx(K,{open:!!x,onClose:()=>t(null),title:x?.action==="delete"?"Delete product":"Bulk editor",danger:x?.action==="delete",message:x?.action==="delete"?`Delete ${x.product?.name||x.product?.id}?`:"Open bulk editor (coming soon)",confirmText:x?.action==="delete"?"Delete":"OK",onConfirm:()=>t(null)})]})}export{W as default};
