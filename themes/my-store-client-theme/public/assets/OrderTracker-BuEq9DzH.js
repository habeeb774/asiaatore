import{ao as y,r as n,j as e}from"./vendor.react-BYd2qOD7.js";import{g as h}from"./index-KQCI4LeS.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */function R(){const{id:d}=y(),[r,l]=n.useState(null),[o,p]=n.useState([]),[m,x]=n.useState(null),j=n.useRef(null),[u,N]=n.useState(null);return n.useEffect(()=>{let s=!0;return(async()=>{try{const t=await h.getOrder(d);s&&l(t.order||t)}catch{}})(),()=>{s=!1}},[d]),n.useEffect(()=>{const s=new EventSource("/api/events");j.current=s;const t=c=>b=>{try{const i=JSON.parse(b.data);i&&i.orderId===d&&(p(a=>[{t:Date.now(),type:c,data:i},...a].slice(0,200)),c==="delivery.updated"&&l(a=>({...a||{},deliveryStatus:i.deliveryStatus,deliveredAt:i.deliveredAt||a&&a.deliveredAt})),c==="delivery.location"&&l(a=>({...a||{},deliveryLocation:i.location})),c==="order.updated"&&l(a=>({...a||{},status:i.status||a&&a.status})))}catch{}};return s.addEventListener("delivery.updated",t("delivery.updated")),s.addEventListener("delivery.location",t("delivery.location")),s.addEventListener("order.updated",t("order.updated")),s.onerror=()=>{N("stream")},()=>{s.close()}},[d]),r?e.jsxs("div",{className:"container-custom p-4",children:[e.jsx("h2",{className:"text-xl font-bold mb-2",children:"ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨"}),e.jsxs("div",{className:"mb-3 text-sm text-gray-700",children:["Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ",r.id]}),e.jsxs("div",{className:"mb-2",children:["Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨: ",e.jsx("span",{className:"font-semibold",children:r.status})]}),e.jsxs("div",{className:"mb-2",children:["Ø­Ø§Ù„Ø© Ø§Ù„ØªÙˆØµÙŠÙ„: ",e.jsx("span",{className:"font-semibold",children:r.deliveryStatus||"â€”"})]}),u&&e.jsx("div",{className:"text-[11px] text-gray-500 mb-2",children:"Ø§Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„Ø­ÙŠØ© ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹."}),e.jsxs("div",{className:"mb-4 flex items-center gap-2 flex-wrap",children:[e.jsx("a",{href:`/api/orders/${r.id}/invoice`,target:"_blank",rel:"noopener",className:"btn-primary text-xs",children:"Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø©"}),e.jsx("button",{className:"btn-secondary text-xs",onClick:async()=>{try{const s=await h.orderShipments(r.id,{refresh:!0}),t=s.shipments||s.items||s||[];x(Array.isArray(t)?t:[])}catch{x([])}},children:"ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø­Ù†Ø§Øª"})]}),e.jsxs("div",{className:"bg-white border rounded p-3 mb-4",children:[e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨"}),e.jsxs("div",{className:"grid gap-2 text-xs sm:grid-cols-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹:"})," ",e.jsx("span",{className:"font-medium",children:r.paymentMethod||"â€”"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Ø§Ù„Ø¹Ù…Ù„Ø©:"})," ",e.jsx("span",{className:"font-medium",children:r.currency||"SAR"})]}),r.paymentMeta?.bank?.reference&&e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Ù…Ø±Ø¬Ø¹ Ø§Ù„ØªØ­ÙˆÙŠÙ„:"})," ",e.jsx("span",{className:"font-medium",children:r.paymentMeta.bank.reference})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Ø£Ù†Ø´Ø¦ ÙÙŠ:"})," ",e.jsx("span",{className:"font-medium",children:new Date(r.createdAt).toLocaleString("ar")})]}),r.updatedAt&&e.jsxs("div",{children:[e.jsx("span",{className:"opacity-70",children:"Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:"})," ",e.jsx("span",{className:"font-medium",children:new Date(r.updatedAt).toLocaleString("ar")})]})]})]}),(()=>{const s=r?.paymentMeta?.address||r?.shippingAddress;if(!s)return null;const t=[s.country,s.city,s.area].filter(Boolean).join(" - ");return e.jsxs("div",{className:"mt-3 border-t pt-3",children:[e.jsx("div",{className:"font-medium text-sm mb-1",children:"Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø´Ø­Ù†"}),e.jsxs("div",{className:"text-xs whitespace-pre-line leading-6",children:[s.name&&e.jsx("div",{children:s.name}),s.email&&e.jsx("div",{className:"opacity-70",children:s.email}),e.jsx("div",{children:t||"â€”"}),s.line1&&e.jsx("div",{children:s.line1}),s.phone&&e.jsxs("div",{children:["ðŸ“ž ",s.phone]})]})]})})()]}),Array.isArray(r.items)&&r.items.length>0&&e.jsxs("div",{className:"bg-white border rounded p-3 mb-4",children:[e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"Ø§Ù„Ø¹Ù†Ø§ØµØ±"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs border rounded overflow-hidden",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-gray-600",children:[e.jsx("th",{className:"text-right p-2 border-b",children:"Ø§Ù„ØµÙ†Ù"}),e.jsx("th",{className:"text-right p-2 border-b",children:"Ø§Ù„ÙƒÙ…ÙŠØ©"}),e.jsx("th",{className:"text-right p-2 border-b",children:"Ø§Ù„Ø³Ø¹Ø±"}),e.jsx("th",{className:"text-right p-2 border-b",children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"})]})}),e.jsx("tbody",{children:r.items.map((s,t)=>e.jsxs("tr",{className:t%2?"bg-white":"bg-gray-50/40",children:[e.jsx("td",{className:"p-2 border-b",children:s.nameAr||s.nameEn||s.name||s.productId}),e.jsx("td",{className:"p-2 border-b",dir:"ltr",children:s.quantity}),e.jsxs("td",{className:"p-2 border-b",dir:"ltr",children:[Number(s.price||0).toFixed(2)," ",r.currency||"SAR"]}),e.jsxs("td",{className:"p-2 border-b",dir:"ltr",children:[Number((s.price||0)*(s.quantity||1)).toFixed(2)," ",r.currency||"SAR"]})]},t))})]})}),e.jsxs("div",{className:"mt-3 grid gap-2 text-xs sm:max-w-xs sm:ml-auto",children:[e.jsxs("div",{className:"flex justify-between opacity-80",children:[e.jsx("span",{children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ"}),e.jsxs("span",{dir:"ltr",children:[Number(r.subtotal??0).toFixed(2)," ",r.currency||"SAR"]})]}),r.discount!=null&&e.jsxs("div",{className:"flex justify-between opacity-80",children:[e.jsx("span",{children:"Ø§Ù„Ø®ØµÙ…"}),e.jsxs("span",{dir:"ltr",children:[Number(r.discount||0).toFixed(2)," ",r.currency||"SAR"]})]}),r.tax!=null&&e.jsxs("div",{className:"flex justify-between opacity-80",children:[e.jsx("span",{children:"Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©"}),e.jsxs("span",{dir:"ltr",children:[Number(r.tax||0).toFixed(2)," ",r.currency||"SAR"]})]}),r.shippingTotal!=null&&e.jsxs("div",{className:"flex justify-between opacity-80",children:[e.jsx("span",{children:"Ø§Ù„Ø´Ø­Ù†"}),e.jsxs("span",{dir:"ltr",children:[Number(r.shippingTotal||0).toFixed(2)," ",r.currency||"SAR"]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-sm",children:[e.jsx("span",{children:"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ"}),e.jsxs("span",{dir:"ltr",children:[Number(r.grandTotal??r.total??0).toFixed(2)," ",r.currency||"SAR"]})]})]})]}),m&&e.jsxs("div",{className:"mb-4 bg-white border rounded p-3",children:[e.jsx("div",{className:"font-semibold mb-2 text-sm",children:"Ø§Ù„Ø´Ø­Ù†Ø§Øª"}),m.length===0?e.jsx("div",{className:"text-xs text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø´Ø­Ù†Ø§Øª Ø¨Ø¹Ø¯"}):e.jsx("ul",{className:"text-xs space-y-1",children:m.map((s,t)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center gap-1",children:e.jsx("span",{className:"px-1.5 py-0.5 rounded bg-gray-100 border text-gray-700",children:s.provider||"provider"})}),e.jsxs("span",{children:["Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹: ",e.jsx("strong",{children:s.trackingNumber||s.trackingId||"â€”"})]}),s.trackingUrl&&e.jsx("a",{href:s.trackingUrl,target:"_blank",rel:"noopener",className:"text-sky-700 underline",children:"Ø±Ø§Ø¨Ø· Ø§Ù„ØªØªØ¨Ø¹"}),e.jsx("span",{className:"ml-auto opacity-70",children:s.status||"â€”"})]},t))})]}),r.deliveryLocation&&e.jsxs("div",{className:"mb-2 text-sm",children:["Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ: lat ",r.deliveryLocation.lat,", lng ",r.deliveryLocation.lng]}),r.deliveredAt&&e.jsxs("div",{className:"text-sm",children:["Ø³ÙÙ„Ù‘Ù… ÙÙŠ: ",new Date(r.deliveredAt).toLocaleString("ar")]}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold mb-2",children:"Ø£Ø­Ø¯Ø§Ø« Ø­ÙŠØ©"}),e.jsxs("ul",{className:"text-xs space-y-1",children:[o.map((s,t)=>e.jsxs("li",{children:["[",new Date(s.t).toLocaleTimeString(),"] ",s.type," â†’ ",JSON.stringify(s.data)]},t)),o.length===0&&e.jsx("li",{className:"text-gray-500",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø­Ø¯Ø§Ø« Ø¨Ø¹Ø¯"})]})]})]}):e.jsx("div",{className:"container-custom p-4",children:"ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨..."})}export{R as default};
