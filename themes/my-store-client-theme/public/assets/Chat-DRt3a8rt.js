import{r as i,u as b,j as s}from"./vendor.react-BYd2qOD7.js";import{z as j,g as c}from"./index-KQCI4LeS.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */function L(){const{threads:x,setThreads:p,currentThread:t,setCurrentThread:y,messages:u,setMessages:d}=j(),[n,f]=i.useState(""),r=i.useRef(null),h=b(),m=i.useMemo(()=>{const l=new URLSearchParams(h.search).get("as");return l==="seller"||l==="delivery"?l:"buyer"},[h.search]),[a,o]=i.useState(m);i.useEffect(()=>{c.chatListThreads(a).then(e=>{e?.ok&&p(e.items||e.threads||[])}).catch(()=>{})},[a,p]),i.useEffect(()=>{t&&c.chatGetMessages(t.id).then(e=>{e?.ok&&d(e.messages||[]),r.current&&(r.current.scrollTop=r.current.scrollHeight)}).catch(()=>{})},[t,d]),i.useEffect(()=>{r.current&&(r.current.scrollTop=r.current.scrollHeight)},[u]);const g=async()=>{if(!(!n.trim()||!t))try{const e=await c.chatSendMessage(t.id,n.trim());e?.ok&&e.message&&d(l=>[...l,e.message]),f(""),r.current&&(r.current.scrollTop=r.current.scrollHeight)}catch{}};return s.jsxs("div",{className:"chat-page",style:{display:"grid",gridTemplateColumns:"280px 1fr",gap:16,padding:16},children:[s.jsxs("aside",{style:{borderInlineStart:"1px solid #e5e7eb",paddingInlineStart:12},children:[s.jsxs("div",{style:{display:"flex",gap:8,marginBottom:8},children:[s.jsx("button",{onClick:()=>o("buyer"),className:a==="buyer"?"active":"",children:"كمشتري"}),s.jsx("button",{onClick:()=>o("seller"),className:a==="seller"?"active":"",children:"كَبائع"}),s.jsx("button",{onClick:()=>o("delivery"),className:a==="delivery"?"active":"",children:"كسائق"})]}),s.jsx("ul",{style:{listStyle:"none",margin:0,padding:0,display:"grid",gap:8},children:x.map(e=>s.jsxs("li",{onClick:()=>y(e),style:{padding:8,border:"1px solid #e5e7eb",borderRadius:8,cursor:"pointer",background:t?.id===e.id?"#f8fafc":"#fff"},children:[s.jsx("div",{style:{fontWeight:700},children:e.title||"محادثة"}),s.jsx("div",{style:{color:"#64748b",fontSize:12},children:e.lastMessage||"—"})]},e.id))})]}),s.jsxs("main",{style:{display:"grid",gridTemplateRows:"1fr auto",border:"1px solid #e5e7eb",borderRadius:12},children:[s.jsxs("div",{ref:r,style:{padding:12,overflow:"auto"},children:[!t&&s.jsx("div",{style:{color:"#64748b"},children:"اختر محادثة…"}),t&&s.jsx("div",{style:{display:"grid",gap:8},children:u.map(e=>s.jsxs("div",{style:{justifySelf:e.role==="buyer"?"end":"start",background:"#f1f5f9",padding:"8px 10px",borderRadius:10,maxWidth:420},children:[s.jsx("div",{style:{fontSize:12,color:"#64748b"},children:new Date(e.createdAt||e.ts).toLocaleTimeString("ar")}),s.jsx("div",{children:e.content||e.text})]},e.id))})]}),s.jsxs("div",{style:{display:"flex",gap:8,padding:12,borderTop:"1px solid #e5e7eb"},children:[s.jsx("input",{value:n,onChange:e=>f(e.target.value),placeholder:"اكتب رسالة…",style:{flex:1,padding:10,border:"1px solid #e5e7eb",borderRadius:8},onKeyDown:e=>{e.key==="Enter"&&g()}}),s.jsx("button",{onClick:g,style:{padding:"10px 14px",border:"1px solid #0ea5e9",background:"#0ea5e9",color:"#fff",borderRadius:8},children:"إرسال"})]})]})]})}export{L as default};
