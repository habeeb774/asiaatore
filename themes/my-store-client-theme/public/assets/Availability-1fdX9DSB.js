import{r as i,j as e,as as h,av as k,aw as b,ap as P}from"./vendor.react-BYd2qOD7.js";import{e as T,g as j,m as N,C as S,h as q,i as A,k as E,n as v}from"./index-KQCI4LeS.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */function U(){const{user:n}=T()||{},[t,m]=i.useState({online:!1,vehicleType:"",licensePlate:""}),[r,p]=i.useState(!1),[c,l]=i.useState(null),[w,g]=i.useState(!0),[f,x]=i.useState(!1),o=i.useCallback(async()=>{try{g(!0),l(null);const s=await j.request("/delivery/me/profile");m(s.profile||{online:!1,vehicleType:"",licensePlate:""})}catch(s){const a=s?.response?.data?.message||s?.message||"فشل تحميل الملف الشخصي";l(a),console.error("Profile load error:",s),(s?.response?.status===401||s?.response?.status===403)&&console.log("محاولة إعادة المصادقة...")}finally{g(!1)}},[]);i.useEffect(()=>{n&&["delivery","admin"].includes(n.role)&&o()},[n,o]);const u=(s,a)=>{m(d=>({...d,[s]:a})),x(!0)},y=async(s=null)=>{p(!0),l(null);try{const a=s||{online:t.online,vehicleType:t.vehicleType,licensePlate:t.licensePlate},d=await j.request("/delivery/me/profile",{method:"PATCH",body:JSON.stringify(a)});m(d.profile||d),x(!1)}catch(a){console.error("Profile update error details:",a),a?.response?.status===403?l("غير مصرح لك بتعديل الملف الشخصي. يرجى التحقق من الصلاحيات."):a?.response?.status===401?l("انتهت جلسة التسجيل. يرجى تسجيل الدخول مرة أخرى."):a?.response?.data?.message?l(a.response.data.message):l("فشل حفظ التغييرات. يرجى المحاولة مرة أخرى.")}finally{p(!1)}},C=async()=>{l(null),await o()};return n?["delivery","admin"].includes(n.role)?e.jsxs("div",{className:"p-6 space-y-6 bg-gray-50 min-h-screen",children:[e.jsxs(N.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(k,{className:"w-6 h-6 text-blue-500"}),"حالة التوافر"]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1",children:"قم بتحديث حالتك ومعلومات المركبة لتظهر للمديرين والعملاء."})]}),c&&e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-start gap-3",children:[e.jsx(h,{className:"w-5 h-5 text-red-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-red-700 text-sm",children:c}),(c.includes("انتهت")||c.includes("غير مصرح"))&&e.jsx("button",{onClick:C,className:"text-red-600 underline text-sm mt-1 hover:text-red-800",children:"إعادة المحاولة"})]})]}),w?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(b,{className:"w-6 h-6 animate-spin text-blue-500"}),e.jsx("span",{className:"mr-2",children:"جاري التحميل..."})]}):e.jsxs(S,{className:"rounded-xl shadow-sm border-gray-200",children:[e.jsx(q,{children:e.jsx(A,{className:"text-lg font-semibold text-gray-700",children:"بيانات الملف الشخصي"})}),e.jsxs(E,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("label",{className:"flex items-center gap-3 text-gray-700 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:!!t?.online,onChange:s=>{u("online",s.target.checked),y({online:s.target.checked}).catch(console.error)},disabled:r,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500"}),e.jsx("span",{className:"font-medium",children:"متاح لاستلام الطلبات"})]}),e.jsx("div",{className:`px-3 py-1 rounded-full text-sm font-medium ${t?.online?"bg-green-100 text-green-800":"bg-gray-100 text-gray-600"}`,children:t?.online?"متاح الآن":"غير متاح"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"نوع المركبة *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg w-full px-4 py-3 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:"مثال: دراجة نارية أو سيارة",value:t?.vehicleType||"",onChange:s=>u("vehicleType",s.target.value),required:!0,disabled:r})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"رقم اللوحة *"}),e.jsx("input",{className:"border border-gray-300 rounded-lg w-full px-4 py-3 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",placeholder:"مثال: 1234 أ",value:t?.licensePlate||"",onChange:s=>u("licensePlate",s.target.value),required:!0,disabled:r})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-gray-200",children:[e.jsxs(v,{variant:"success",disabled:r||!f,onClick:()=>y(),className:"flex items-center gap-2",children:[r?e.jsx(b,{className:"w-4 h-4 animate-spin"}):e.jsx(P,{className:"w-4 h-4"}),r?"جارٍ الحفظ...":"حفظ التغييرات"]}),f&&e.jsx(v,{variant:"outline",onClick:()=>{x(!1),o()},disabled:r,children:"إلغاء"})]})]})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"غير مصرح بالوصول"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"ليس لديك الصلاحيات الكافية للوصول إلى هذه الصفحة"})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(h,{className:"w-12 h-12 text-yellow-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:"يجب تسجيل الدخول"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"يرجى تسجيل الدخول للوصول إلى هذه الصفحة"})]})}export{U as default};
