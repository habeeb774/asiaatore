import{r as g,j as e,L as o}from"./vendor.react-BYd2qOD7.js";import{f as h,e as u}from"./index-KQCI4LeS.js";import{o as y}from"./invoiceService-BN1qyjVf.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */import"./apiService-DNwSxsHw.js";const m=["pending","pending_bank_review","processing","shipped","delivered"];function j({status:i}){const d=m.indexOf(i);return e.jsx("div",{className:"offers-page catalog-page container-custom px-4 py-8",children:m.map((r,n)=>{const a=d>=n;return e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`px-2 py-1 rounded border ${a?"bg-green-600 text-white border-green-600":"bg-gray-100 text-gray-500 border-gray-300"}`,children:r}),n<m.length-1&&e.jsx("span",{className:`w-6 h-px ${d>=n+1?"bg-green-600":"bg-gray-300"}`})]},r)})})}const T=()=>{const{paged:i,loading:d,error:r,refresh:n}=h()||{},{user:a}=u()||{},x=g.useMemo(()=>(i||[]).filter(s=>String(s.userId)===String(a?.id||"guest")),[i,a]);return a?d?e.jsx("div",{className:"container-custom px-4 py-12 text-center text-sm opacity-70",children:"جار التحميل..."}):r?e.jsxs("div",{className:"container-custom px-4 py-12 text-center text-sm text-red-600",children:["خطأ: ",r]}):x.length===0?e.jsx("div",{className:"container-custom px-4 py-12 text-center",children:"لا توجد طلبات حتى الآن"}):e.jsxs("div",{className:"container-custom px-4 py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["طلباتي (",x.length,")"]}),e.jsx("button",{onClick:()=>n(),className:"btn-secondary px-3 py-2 text-sm",children:"تحديث"})]}),e.jsx("div",{className:"space-y-5",children:x.map(s=>{const p=s.grandTotal??s.total??(s.items||[]).reduce((t,c)=>t+(c.price||0)*(c.quantity||1),0),l=s.shipments&&s.shipments.length?s.shipments[0]:null;return e.jsxs("div",{className:"border rounded p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:["#",s.id]}),e.jsx("div",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleString()}),e.jsxs("div",{className:"text-sm mt-1",children:["الإجمالي: ",e.jsxs("strong",{children:[p," ",s.currency||"ر.س"]})]}),l&&e.jsxs("div",{className:"text-xs text-gray-700 mt-1 flex items-center gap-2",children:[e.jsx("span",{children:"رقم التتبع:"}),e.jsx("code",{className:"px-1.5 py-0.5 bg-gray-100 rounded",children:l.trackingNumber}),l.trackingUrl&&e.jsx("a",{className:"text-primary-red hover:underline",href:l.trackingUrl,target:"_blank",rel:"noopener noreferrer",children:"تتبّع خارجي"})]})]}),e.jsxs("div",{className:"text-sm flex flex-col items-start gap-1 min-w-[180px]",children:[e.jsx("span",{className:"inline-block px-2 py-0.5 rounded bg-slate-100 text-slate-700 text-xs",children:s.status}),e.jsx(o,{to:`/order/${s.id}`,className:"btn-secondary px-3 py-1 text-xs",children:"تفاصيل"}),e.jsx(o,{to:`/order/${s.id}/track`,className:"btn-secondary px-3 py-1 text-xs",children:"تتبع"}),e.jsx("a",{href:`/api/orders/${s.id}/invoice`,target:"_blank",rel:"noopener",className:"btn-secondary px-3 py-1 text-xs",children:"فاتورة"}),s.status==="paid"&&e.jsx("button",{type:"button",className:"btn-secondary px-3 py-1 text-xs",onClick:async()=>{try{await y(s.id,{format:"a4"})}catch(t){alert("تعذر فتح الفاتورة: "+(t?.message||"خطأ"))}},children:"فاتورة (جديدة)"})]})]}),e.jsx(j,{status:s.status}),e.jsxs("div",{className:"mt-4 grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(s.items||[]).slice(0,6).map(t=>{const c=typeof t.name=="string"?t.name:t.name?.ar||t.name?.en||t.productId;return e.jsxs("div",{className:"p-2 border rounded text-xs flex flex-col gap-1 bg-white/50",children:[e.jsx("div",{className:"font-semibold truncate",title:c,children:c}),e.jsxs("div",{className:"text-gray-600",children:[t.quantity," × ",t.price," = ",(t.quantity||1)*t.price]})]},t.id)}),(s.items||[]).length>6&&e.jsxs("div",{className:"text-xs text-gray-500 flex items-center",children:["+",(s.items||[]).length-6," عناصر إضافية"]})]})]},s.id)})})]}):e.jsx("div",{className:"container-custom px-4 py-12 text-center",children:"الرجاء تسجيل الدخول لعرض طلباتك"})};export{T as default};
