import{b as I,u as D,am as L,R as w,j as e,L as f,r as j}from"./vendor.react-BYd2qOD7.js";import{e as F,C as N,h as y,i as S,j as v,k as E,I as g,n as b,g as C}from"./index-KQCI4LeS.js";import{c0 as A,c1 as P,c2 as x}from"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */const T=P({email:x().email("البريد الإلكتروني غير صحيح").min(1,"البريد مطلوب"),password:x().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل")}),K=()=>{const{login:o,devLoginAs:c}=F()||{},u=I(),l=D(),t=l.state&&l.state.from||new URLSearchParams(l.search).get("redirect")||"/",{register:s,handleSubmit:m,formState:{errors:i,isSubmitting:n},setError:r,setFocus:a}=L({resolver:A(T),mode:"onSubmit"}),[d,R]=w.useState(!1);w.useEffect(()=>{a("email")},[a]);const _=async h=>{try{const p=await o(h.email.trim(),h.password);if(p.ok)u(t,{replace:!0});else{const k=p?.error==="INVALID_LOGIN"?"بيانات دخول خاطئة":p?.error==="USER_BLOCKED"?"تم إيقاف حسابك مؤقتًا":p?.error==="EMAIL_NOT_VERIFIED"?"يرجى تأكيد بريدك الإلكتروني أولاً":p?.error||"فشل تسجيل الدخول";r("root",{message:k})}}catch(p){r("root",{message:p.message||"خطأ غير متوقع"})}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(y,{children:[e.jsx(S,{children:"تسجيل الدخول"}),e.jsx(v,{children:"ادخل بيانات حسابك للوصول إلى المتجر ولوحة التحكم."})]}),e.jsxs(E,{children:[e.jsxs("form",{onSubmit:m(_),className:"grid gap-4","aria-describedby":i.root?"login-error":void 0,children:[e.jsx(g,{id:"email",type:"email",label:"البريد الإلكتروني",autoComplete:"email",placeholder:"example@mail.com",error:i.email?.message,...s("email")}),e.jsxs("div",{className:"relative",children:[e.jsx(g,{id:"password",type:d?"text":"password",label:"كلمة المرور",autoComplete:"current-password",placeholder:"••••••••",error:i.password?.message,...s("password"),className:"pr-16"}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",className:"absolute top-1/2 -translate-y-1/2 right-1 text-xs text-gray-600 mt-3",onClick:()=>R(h=>!h),title:d?"إخفاء":"إظهار",children:d?"إخفاء":"إظهار"})]}),i.root&&e.jsx("div",{id:"login-error",className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",role:"alert",children:i.root.message}),e.jsx(b,{type:"submit",disabled:n,variant:"secondary",className:"w-full bg-sky-600 hover:bg-sky-700 text-white border-transparent",children:n?"...جاري الدخول":"دخول"})]}),e.jsxs("div",{className:"mt-4 grid gap-2",children:[e.jsx(f,{to:"/forgot",className:"text-xs underline text-gray-600 hover:text-gray-800",children:"نسيت كلمة المرور؟"}),!1]}),e.jsxs("p",{className:"mt-3 text-[0.72rem]",children:["ليس لديك حساب؟ ",e.jsx(f,{to:"/register",className:"underline",children:"إنشاء حساب"})]})]})]})})},B=P({name:x().trim().optional(),email:x().email("البريد الإلكتروني غير صحيح").min(1,"البريد مطلوب"),password:x().min(6,"كلمة المرور يجب أن تكون 6 أحرف على الأقل"),confirm:x().min(6,"التأكيد مطلوب")}).refine(o=>o.password===o.confirm,{message:"كلمتا المرور غير متطابقتين",path:["confirm"]}),q=()=>{const o=I(),{register:c,handleSubmit:u,setFocus:l,setError:t,formState:{errors:s,isSubmitting:m}}=L({resolver:A(B),mode:"onSubmit"});w.useEffect(()=>{l("email")},[l]);const i=async n=>{try{const r=await C.authRegister(n.email.trim(),n.password,(n.name||"").trim());if(r?.ok){o("/login",{replace:!0,state:{justRegistered:!0}});return}const a=r?.error==="EMAIL_EXISTS"?"البريد مستخدم بالفعل":r?.error||"فشل التسجيل";t("root",{message:a})}catch(r){const a=r?.code,d=r?.status;if(a==="EMAIL_EXISTS"||d===409)return t("email",{message:"البريد مستخدم بالفعل"});if(a==="INVALID_INPUT"||d===400)return t("root",{message:"بيانات غير صالحة، تحقق من الحقول"});if(a==="BAD_JSON")return t("root",{message:"خطأ في تنسيق البيانات، حاول مرة أخرى"});if(a==="DB_UNAVAILABLE"||d===503)return t("root",{message:"الخدمة غير متاحة مؤقتاً، حاول لاحقاً"});t("root",{message:r?.message&&r.message.replace(/^API Error \d+[^-]*-\s*/,"")||"خطأ غير متوقع"})}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(y,{children:[e.jsx(S,{children:"إنشاء حساب"}),e.jsx(v,{children:"أدخل بياناتك لإنشاء حساب جديد."})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:u(i),className:"grid gap-3","aria-describedby":s.root?"register-error":void 0,children:[e.jsx(g,{id:"name",label:"الاسم",placeholder:"الاسم",error:s.name?.message,...c("name")}),e.jsx(g,{id:"email",type:"email",label:"البريد الإلكتروني",autoComplete:"email",placeholder:"example@mail.com",error:s.email?.message,...c("email")}),e.jsx(g,{id:"password",type:"password",label:"كلمة المرور",autoComplete:"new-password",placeholder:"••••••••",error:s.password?.message,...c("password")}),e.jsx(g,{id:"confirm",type:"password",label:"تأكيد كلمة المرور",autoComplete:"new-password",placeholder:"••••••••",error:s.confirm?.message,...c("confirm")}),s.root&&e.jsx("div",{id:"register-error",className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",role:"alert",children:s.root.message}),e.jsx(b,{type:"submit",disabled:m,className:"w-full",children:m?"...جاري":"تسجيل"}),e.jsxs("p",{className:"mt-1 text-[0.72rem]",children:["لديك حساب؟ ",e.jsx(f,{to:"/login",className:"underline",children:"دخول"})]})]})})]})})},Q=()=>{const[o,c]=j.useState(""),[u,l]=j.useState(!1),[t,s]=j.useState(null),[m,i]=j.useState(!1),n=async r=>{if(r.preventDefault(),!m){if(s(null),!o.trim())return s("أدخل البريد");try{i(!0);const a=await C.authForgot(o.trim());a.ok?l(!0):s(a.error||"فشل الإرسال")}catch(a){s(a.message||"خطأ غير متوقع")}finally{i(!1)}}};return e.jsx("div",{className:"min-h-[calc(100vh-120px)] w-full grid place-items-center p-4",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(y,{children:[e.jsx(S,{children:"استرجاع كلمة المرور"}),e.jsx(v,{children:"أدخل بريدك الإلكتروني المسجل وسنرسل لك رابطًا لإعادة تعيين كلمة المرور."})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:n,className:"grid gap-3",children:[e.jsx(g,{id:"email",type:"email",label:"البريد الإلكتروني",placeholder:"example@mail.com",value:o,onChange:r=>c(r.target.value),error:t&&!u?t:void 0}),u&&e.jsx("div",{className:"rounded-md border border-green-200 bg-green-50 px-3 py-2 text-xs text-green-700",children:"تم إرسال رابط (وهمي) إن كان البريد مسجلاً."}),e.jsx(b,{type:"submit",disabled:m,className:"w-full",children:m?"...إرسال":"إرسال رابط"}),e.jsxs("p",{className:"mt-1 text-[0.72rem]",children:["تذكرت؟ ",e.jsx(f,{to:"/login",className:"underline",children:"عودة لتسجيل الدخول"})]})]})})]})})};export{Q as ForgotPasswordPage,K as LoginPage,q as RegisterPage};
