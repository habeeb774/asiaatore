import{r,j as e,P as p,at as j,au as f}from"./vendor.react-BYd2qOD7.js";import{e as S,g as C}from"./index-KQCI4LeS.js";import{B as y}from"./badge-BxPRoUlF.js";import"./vendor-B1AZ7KNd.js";import"./vendor.router-BdFOcp8q.js";import"./vendor.i18next-COqwnjR1.js";import"./vendor.zustand-BuMo4m-J.js";import"./vendor.tanstack-K6OTystZ.js";import"./vendor.leaflet-DeoKySpZ.js";/* empty css                     */function _(){const{user:d}=S()||{},[a,c]=r.useState("delivered"),[n,v]=r.useState([]),[m,o]=r.useState(!0),[x,u]=r.useState(null),[t,b]=r.useState({page:1,limit:20,total:0}),l=r.useCallback(async(s=a,h=1)=>{o(!0),u(null);try{const i=await C.deliveryHistory({status:s,limit:t.limit,page:h});v(i.orders||[]),b(w=>({...w,page:h,total:i.total||0}))}catch(i){u(i?.response?.data?.message||i?.message||"فشل تحميل البيانات"),console.error("History load error:",i)}finally{o(!1)}},[a,t.limit]);if(r.useEffect(()=>{l(a,1)},[a,l]),!d)return e.jsx("div",{className:"container mx-auto p-4",children:"يجب تسجيل الدخول"});if(!["delivery","admin"].includes(d.role))return e.jsx("div",{className:"container mx-auto p-4",children:"غير مصرح بالوصول"});const N=s=>{switch(s){case"delivered":return"success";case"failed":return"danger";case"out_for_delivery":return"info";case"accepted":return"warning";default:return"neutral"}},g=s=>new Date(s).toLocaleString("ar-SA",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:"container mx-auto p-4 max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{className:"w-8 h-8 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"سجل الطلبات"})]}),e.jsxs("div",{className:"flex gap-2 bg-gray-100 p-1 rounded-lg",children:[e.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition ${a==="delivered"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,onClick:()=>c("delivered"),children:[e.jsx(j,{className:"w-4 h-4"}),"تم التسليم"]}),e.jsxs("button",{className:`flex items-center gap-2 px-4 py-2 rounded-md text-sm font-medium transition ${a==="failed"?"bg-white text-red-600 shadow-sm":"text-gray-600 hover:text-gray-800"}`,onClick:()=>c("failed"),children:[e.jsx(f,{className:"w-4 h-4"}),"تعذر التسليم"]})]})]}),m&&e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"mr-3 text-gray-600",children:"جاري التحميل..."})]}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-red-700 text-sm",children:x}),e.jsx("button",{onClick:()=>l(),className:"mt-2 text-red-600 hover:text-red-800 text-sm",children:"إعادة المحاولة"})]}),e.jsx("div",{className:"grid gap-4",children:n?.length?n.map(s=>e.jsx("div",{className:"rounded-lg border border-gray-200 p-4 bg-white shadow-sm hover:shadow-md transition",children:e.jsx("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"font-semibold text-gray-900 text-lg",children:["الطلب #",s.id.slice(0,8),"..."]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(y,{color:"neutral",children:["طلب: ",s.status]}),e.jsxs(y,{color:N(s.deliveryStatus),children:["توصيل: ",s.deliveryStatus]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-700",children:[e.jsxs("div",{children:["الإجمالي: ",e.jsxs("strong",{children:[s.grandTotal," ر.س"]})]}),s.customerName&&e.jsxs("div",{children:["العميل: ",s.customerName]}),s.address&&e.jsxs("div",{children:["العنوان: ",s.address]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-3 text-xs text-gray-500",children:[s.deliveredAt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"w-3 h-3"}),"اكتمل: ",g(s.deliveredAt)]}),s.failedAt&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(f,{className:"w-3 h-3"}),"فشل: ",g(s.failedAt)]})]})]})})},s.id)):!m&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"لا توجد طلبات في هذا القسم"}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:a==="delivered"?"لم يتم تسليم أي طلبات بعد":"لا توجد طلبات فاشلة في التسليم"})]})}),t.total>t.limit&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-6",children:[e.jsx("button",{disabled:t.page===1,onClick:()=>l(a,t.page-1),className:"px-3 py-2 rounded border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"السابق"}),e.jsxs("span",{className:"px-3 py-2 text-sm text-gray-600",children:["الصفحة ",t.page," من ",Math.ceil(t.total/t.limit)]}),e.jsx("button",{disabled:t.page>=Math.ceil(t.total/t.limit),onClick:()=>l(a,t.page+1),className:"px-3 py-2 rounded border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed",children:"التالي"})]})]})}export{_ as default};
